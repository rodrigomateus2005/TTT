var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var C_Pro_Re = /** @class */ (function (_super) {
    __extends(C_Pro_Re, _super);
    function C_Pro_Re() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(C_Pro_Re.prototype, "txtCodReferencia", {
        get: function () {
            return window['txtCodReferencia_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "AgpRef", {
        get: function () {
            return window['AgpRef_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtReferencia", {
        get: function () {
            return window['txtReferencia_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtProcuraReferencia", {
        get: function () {
            return window['txtProcuraReferencia_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtProcuraImportacao", {
        get: function () {
            return window['txtProcuraImportacao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtDescricao", {
        get: function () {
            return window['txtDescricao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtModelo", {
        get: function () {
            return window['txtModelo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtPrecoCusto", {
        get: function () {
            return window['txtPrecoCusto_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Tab", {
        get: function () {
            return window['Tab_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtMargem", {
        get: function () {
            return window['txtMargem_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtPrecoVenda", {
        get: function () {
            return window['txtPrecoVenda_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtLinha", {
        get: function () {
            return window['txtLinha_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtMarca", {
        get: function () {
            return window['txtMarca_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtEstoque", {
        get: function () {
            return window['txtEstoque_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtDecreto", {
        get: function () {
            return window['txtDecreto_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboConvUndNf", {
        get: function () {
            return window['cboConvUndNf_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtPeso", {
        get: function () {
            return window['txtPeso_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtDataVigencia", {
        get: function () {
            return window['txtDataVigencia_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboIAT", {
        get: function () {
            return window["cboIAT_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboUnidade", {
        get: function () {
            return window['cboUnidade_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboTaxaTributaria", {
        get: function () {
            return window['cboTaxaTributaria_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "lblCadastrado", {
        get: function () {
            return window["lblCadastrado_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "hdnRespostaDataVigencia", {
        get: function () {
            return window["hdnRespostaDataVigencia"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "hdnRespostaCodBarra", {
        get: function () {
            return window["hdnRespostaCodBarra"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "hdnRespostaCodBarraLista", {
        get: function () {
            return window["hdnRespostaCodBarraLista"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdImpostos", {
        get: function () {
            return window['grdImpostos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Impostos", {
        get: function () {
            return this.GetScope()["Impostos"];
        },
        set: function (value) {
            this.GetScope()["Impostos"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtDescricaoCusto", {
        get: function () {
            return window["txtDescricaoCusto_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboOperacaoCusto", {
        get: function () {
            return window["cboOperacaoCusto_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "optTipoCalculo", {
        get: function () {
            return window["optTipoCalculo_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtValorCusto", {
        get: function () {
            return window["txtValorCusto_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdCustos", {
        get: function () {
            return window['grdCustos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Custos", {
        get: function () {
            return this.GetScope()["Custos"];
        },
        set: function (value) {
            this.GetScope()["Custos"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Custo", {
        get: function () {
            return this.GetScope()["Custo"];
        },
        set: function (value) {
            this.GetScope()["Custo"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdPrecos", {
        get: function () {
            return window['grdPrecos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Precos", {
        get: function () {
            return this.GetScope()["Precos"];
        },
        set: function (value) {
            this.GetScope()["Precos"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdPersonalizados", {
        get: function () {
            return window['grdPersonalizados_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Personalizados", {
        get: function () {
            return this.GetScope()["Personalizados"];
        },
        set: function (value) {
            this.GetScope()["Personalizados"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtFornecedor", {
        get: function () {
            return window['txtFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdFornecedores", {
        get: function () {
            return window['grdFornecedores_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Fornecedores", {
        get: function () {
            return this.GetScope()["Fornecedores"];
        },
        set: function (value) {
            this.GetScope()["Fornecedores"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboEmpresaCfop", {
        get: function () {
            return window['cboEmpresaCfop_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboCfop", {
        get: function () {
            return window['cboCfop_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboRegraCfop", {
        get: function () {
            return window['cboRegraCfop_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdRegraCfop", {
        get: function () {
            return window['grdRegraCfop_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Cfops", {
        get: function () {
            return this.GetScope()["Cfops"];
        },
        set: function (value) {
            this.GetScope()["Cfops"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboEmpresaIva", {
        get: function () {
            return window['cboEmpresaIva_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboEstadoIva", {
        get: function () {
            return window['cboEstadoIva_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtIvaPauta", {
        get: function () {
            return window['txtIvaPauta_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtPautaValor", {
        get: function () {
            return window['txtPautaValor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdIva", {
        get: function () {
            return window['grdIva_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Ivas", {
        get: function () {
            return this.GetScope()["Ivas"];
        },
        set: function (value) {
            this.GetScope()["Ivas"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "btnGravar", {
        get: function () {
            return window['btnGravar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "btnExcluir", {
        get: function () {
            return window['btnExcluir_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "btnNovo", {
        get: function () {
            return window['btnNovo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboUnidadeConversao", {
        //Fator de Conversao de Unidade
        get: function () {
            return window['cboUnidadeConversao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "cboCalculo", {
        get: function () {
            return window['cboCalculo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtFatorConversao", {
        get: function () {
            return window['txtFatorConversao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtCustoConversao", {
        get: function () {
            return window['txtCustoConversao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtVendaConversao", {
        get: function () {
            return window['txtVendaConversao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdConversao", {
        get: function () {
            return window['grdConversao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Conversoes", {
        get: function () {
            return this.GetScope()["Conversoes"];
        },
        set: function (value) {
            this.GetScope()["Conversoes"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtCodigoProduto", {
        //PRODUTOS
        get: function () {
            return window["txtCodigoProduto_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtCodigoBarras", {
        get: function () {
            return window["txtCodigoBarras_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtCor", {
        get: function () {
            return window["txtCor_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtTamanho", {
        get: function () {
            return window["txtTamanho_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtEstoqueMinimo", {
        get: function () {
            return window["txtEstoqueMinimo_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "txtObservacao", {
        get: function () {
            return window["txtObservacao_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "grdProdutos", {
        get: function () {
            return window['grdProdutos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Produtos", {
        get: function () {
            return this.GetScope()["Produtos"];
        },
        set: function (value) {
            this.GetScope()["Produtos"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "Produto", {
        get: function () {
            return this.GetScope()["Produto"];
        },
        set: function (value) {
            this.GetScope()["Produto"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "mdProcura", {
        get: function () {
            return window['mdProcura_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_Pro_Re.prototype, "dvPrincipal", {
        get: function () {
            return $("#dvPrincipal")[0];
        },
        enumerable: true,
        configurable: true
    });
    C_Pro_Re.prototype.Init = function () {
        _super.prototype.Init.call(this);
        if (this.txtCodReferencia) {
            adicionarEventoMoura(this.txtCodReferencia.Procurou, this.OnPesquisouCodReferencia, this);
        }
        if (this.txtReferencia) {
            //Caso a configuração "Utilizar Marca como Chave do Cad. Prod. Referência" (Marca_Chave_Referencia)
            //estiver marcada deve ser adicionado o evento no TextChanged da txtMarca em vez da txtReferencia
            if (!ValoresSismoura.ConfiguracoesRetaguarda.Marca_Chave_Referencia) {
                adicionarEventoMoura(this.txtReferencia.TextChanged, this.OnTxtReferenciaChange, this);
            }
            adicionarEventoJQuery(this.txtReferencia.Textbox, "keydown", this.OnTxtReferenciaKeyDown, this);
        }
        if (ValoresSismoura.ConfiguracoesRetaguarda.Marca_Chave_Referencia && this.txtMarca) {
            adicionarEventoMoura(this.txtMarca.TextChanged, this.OnTxtReferenciaChange, this);
        }
        if (this.txtProcuraReferencia) {
            adicionarEventoMoura(this.txtProcuraReferencia.Procurou, this.OnProcurouReferencia, this);
        }
        if (this.txtProcuraImportacao) {
            adicionarEventoMoura(this.txtProcuraImportacao.Procurou, this.OnProcurouImportacao, this);
        }
        if (this.txtMargem) {
            adicionarEventoMoura(this.txtMargem.TextChanged, this.OnTxtMargemChange, this);
        }
        if (this.txtPrecoVenda) {
            adicionarEventoMoura(this.txtPrecoVenda.TextChanged, this.OnTxtPrecoVendaChange, this);
        }
        //GRIDS
        if (this.grdFornecedores) {
            adicionarEventoMoura(this.grdFornecedores.AdicionandoItem, this.OnClickIncluirFornecedor, this);
        }
        if (this.grdCustos) {
            adicionarEventoMoura(this.grdCustos.AdicionandoItem, this.OnClickIncluirCustos, this);
        }
        if (this.grdRegraCfop) {
            adicionarEventoMoura(this.grdRegraCfop.AdicionandoItem, this.OnClickIncluirRegraCfop, this);
        }
        if (this.grdIva) {
            adicionarEventoMoura(this.grdIva.AdicionandoItem, this.OnClickIncluirIvaPauta, this);
        }
        if (this.grdConversao) {
            adicionarEventoMoura(this.grdConversao.AdicionandoItem, this.OnClickIncluirConversao, this);
        }
        if (this.grdProdutos) {
            adicionarEventoMoura(this.grdProdutos.Grid.CellPrepared, this.OnGerouCelulaGradeProduto, this);
            adicionarEventoMoura(this.grdProdutos.AdicionandoItem, this.OnClickIncluirProduto, this);
            adicionarEventoMoura(this.grdProdutos.Grid.CellPrepared, this.OnGrdProdutosCellPrepared, this);
            adicionarEventoMoura(this.grdProdutos.AlterandoItem, this.OnAlterandoItemProduto, this);
        }
        if (this.grdImpostos) {
            adicionarEventoMoura(this.grdImpostos.EditouItemGrade, this.OnClicouCellGrdImpostos, this);
        }
        if (this.txtCodigoProduto) {
            adicionarEventoMoura(this.txtCodigoProduto.Procurou, this.OnPesquisouCodigoProduto, this);
        }
        //CRUD
        if (this.btnNovo) {
            adicionarEventoMoura(this.btnNovo.Click, this.OnClickBtnNovo, this);
        }
        if (this.btnGravar) {
            adicionarEventoMoura(this.btnGravar.Click, this.OnClickBtnGravar, this);
        }
        if (this.btnExcluir) {
            adicionarEventoMoura(this.btnExcluir.Click, this.OnClickBtnExcluir, this);
        }
        if (this.dvPrincipal) {
            adicionarEventoJQuery(this.dvPrincipal, "keydown", this.OnTxtUsarReferenciaKeyDown, this);
        }
    };
    C_Pro_Re.prototype.OnPageLoad = function () {
        _super.prototype.OnPageLoad.call(this);
        this.configuracoesCamposIniciais();
        this.configuracoesGridsIniciais();
    };
    C_Pro_Re.prototype.OnPesquisouCodReferencia = function (s, e) {
        this.OnDepoisBuscarExistente();
    };
    C_Pro_Re.prototype.OnGerouCelulaGradeProduto = function (s, e) {
        if (e.rowType == "data" && e.data) {
            var valorColuna = e.data['Inativo'];
            var coluna = e.column;
            if (valorColuna && coluna) {
                var corCelula = "";
                switch (valorColuna) {
                    case true: {
                        corCelula = "red";
                        break;
                    }
                    case false: {
                        corCelula = "black";
                        break;
                    }
                    default: {
                        corCelula = "";
                        break;
                    }
                }
                if (!String.IsNullOrWhiteSpace(corCelula)) {
                    //e.cellElement.css("background-color", corCelula);
                    e.cellElement.css("color", corCelula);
                }
            }
        }
    };
    C_Pro_Re.prototype.OnTxtReferenciaChange = function () {
        if (this.txtCodReferencia.GetText().CNum() <= 0) {
            this.OnDepoisBuscarExistente();
        }
    };
    C_Pro_Re.prototype.OnTxtUsarReferenciaKeyDown = function (e) {
        var abrirPesquisa = false;
        if (e.keyCode == 118) {
            if (this.Produtos.length == 0) {
                abrirPesquisa = true; //F7
                if (abrirPesquisa) {
                    this.txtProcuraImportacao.abrirProcura("");
                }
            }
            else {
                MostrarAlerta("Não é possível importar produtos, pois esta referencia já tem produtos vinculados");
            }
        }
    };
    C_Pro_Re.prototype.OnTxtReferenciaKeyDown = function (e) {
        var abrirPesquisa = false;
        if (e.keyCode == 113)
            abrirPesquisa = true; //F2
        if (abrirPesquisa) {
            this.txtProcuraReferencia.abrirProcura("");
        }
    };
    C_Pro_Re.prototype.OnProcurouImportacao = function (s, e) {
        this.txtDescricao.SetText(this.txtProcuraImportacao.GetResultado());
        this.GetScope()["Entity"].Nome = this.txtProcuraImportacao.GetResultado();
    };
    C_Pro_Re.prototype.OnProcurouReferencia = function (s, e) {
        var parametros = {
            codigoProduto: this.txtProcuraReferencia.GetText().CNum()
        };
        var referencia = this.ExecutarFuncaoServerSideSynch("GetReferenciaProduto", parametros);
        this.txtReferencia.SetText(referencia);
        this.OnDepoisBuscarExistente();
        this.txtDescricao.Focus();
    };
    C_Pro_Re.prototype.OnTxtMargemChange = function () {
        this.CalculaPrecoVendaProduto(this.txtPrecoCusto.GetText().CNum(), this.txtMargem.GetText().CNum());
    };
    C_Pro_Re.prototype.OnTxtPrecoVendaChange = function () {
        if (this.txtPrecoCusto.GetText().CNum() > 0) {
            this.GetScope()["Entity"].Margem = ((this.txtPrecoVenda.GetText().CNum() * 100) / this.txtPrecoCusto.GetText().CNum()) - 100;
            this.GetScope().$applyAsync();
        }
    };
    C_Pro_Re.prototype.CalculaPrecoVendaProduto = function (precoCusto, margem) {
        var aux = 0;
        var conceitoPreco = this.ExecutarFuncaoServerSideSynch("GetConfigConceitoPreco", {});
        if (String.IsNullOrWhiteSpace(conceitoPreco))
            conceitoPreco = "PREÇO POR FORA";
        switch (conceitoPreco.toUpperCase()) {
            case "PREÇO POR FORA": {
                aux = ((precoCusto * margem) / 100) + precoCusto;
                break;
            }
            case "PREÇO POR DENTRO":
            case "(VENDA-CUSTO)/VENDA": {
                if ((1 - (margem / 100)) > 0) {
                    aux = precoCusto / (1 - (margem / 100));
                }
                break;
            }
        }
        this.GetScope()["Entity"].Preco_Produto = aux;
        this.GetScope().$applyAsync();
    };
    C_Pro_Re.prototype.OnDepoisBuscarExistente = function () {
        var _this = this;
        abrirEspera();
        setTimeout(function () {
            if (ValoresSismoura.UsarCadastroReferencia) {
                _this.txtReferencia.SetText(c_Pro_Re.txtCodReferencia.hdnLabelResultadoText.value);
            }
            var codReferencia = _this.txtCodReferencia.GetText().CNum();
            var referencia = _this.txtReferencia.GetText();
            var codMarca = _this.txtMarca.GetText().CNum();
            try {
                //if (codReferencia > 0 || !String.IsNullOrWhiteSpace(referencia)) {
                //    abrirEspera();
                //let configMarca: boolean = this.ExecutarFuncaoServerSideSynch("GetConfigMarcaChaveReferencia", <JSON>{})
                var Entity;
                var parametros = {};
                if (!ValoresSismoura.ConfiguracoesRetaguarda.Marca_Chave_Referencia) {
                    // Se não usar a configuração Marca_Chave_Produto
                    if (codReferencia > 0 || !String.IsNullOrWhiteSpace(referencia)) {
                        abrirEspera();
                        parametros = {
                            codReferencia: codReferencia,
                            referencia: referencia,
                            usarCadastroReferencia: ValoresSismoura.UsarCadastroReferencia
                        };
                        Entity = _this.ExecutarFuncaoServerSideSynch("GetProduto", parametros);
                    }
                }
                else {
                    // Se usar a configuração Marca_Chave_Produto
                    if ((codReferencia > 0 || !String.IsNullOrWhiteSpace(referencia)) && codMarca > 0) {
                        abrirEspera();
                        parametros = {
                            codReferencia: codReferencia,
                            referencia: referencia,
                            codMarca: codMarca,
                            usarCadastroReferencia: ValoresSismoura.UsarCadastroReferencia
                        };
                        Entity = _this.ExecutarFuncaoServerSideSynch("GetProdutoReferenciaMarca", parametros);
                    }
                }
                if (Entity) {
                    //PRODUTOS
                    parametros.codUsuario = ValoresSismoura.UsuarioLogado;
                    if (!ValoresSismoura.ConfiguracoesRetaguarda.Marca_Chave_Referencia) {
                        _this.Produtos = _this.ExecutarFuncaoServerSideSynch("GetProdutosDadosReferencia", parametros);
                    }
                    else {
                        _this.Produtos = _this.ExecutarFuncaoServerSideSynch("GetProdutosDadosReferenciaMarca", parametros);
                    }
                    if (_this.Produtos.length > 0) {
                        for (var x = 0; x < _this.Produtos.length; x++) {
                            _this.Produtos[x].Data_Alteracao = ConvertToDate(_this.Produtos[x].Data_Alteracao);
                            _this.Produtos[x].Data_Cadastro = ConvertToDate(_this.Produtos[x].Data_Cadastro);
                        }
                    }
                    parametros = {
                        produtos: _this.Produtos
                    };
                    //FORNECEDOR
                    _this.Fornecedores = _this.ExecutarFuncaoServerSideSynch("GetFornecedores", parametros);
                    //PERSONALIZADOS
                    _this.criarEntidadePersonalizados(Entity);
                    // this.preencherGridPersonalizados(Entity.Codigo);
                    //PRECOS
                    _this.preencherListaPreco(Entity.Codigo, "");
                    //Imposto
                    _this.preencherGridImpostos(Entity.Codigo);
                    //Imposto
                    _this.preencherGridCustos(Entity.Codigo);
                    //REGRA CFOPS e IVAS
                    parametros = {
                        codigoProduto: Entity.Codigo
                    };
                    _this.Cfops = _this.ExecutarFuncaoServerSideSynch("GetRegraCfops", parametros);
                    _this.Ivas = _this.ExecutarFuncaoServerSideSynch("GetIvas", parametros);
                    _this.GetScope()["Entity"] = Entity;
                    _this.lblCadastrado.Visible = false;
                }
                else {
                    if (!String.IsNullOrWhiteSpace(referencia)) {
                        _this.lblCadastrado.Visible = true;
                    }
                    _this.LimparCampos();
                }
                _this.GetScope()["Entity"].Referencia = referencia;
                _this.txtReferencia.SetText(referencia);
                _this.GetScope().$applyAsync();
                fecharEspera();
                //} //fim IF (Marca_Chave_Referencia)
            }
            catch (ex) {
                fecharEspera();
                LogarException(ex);
            }
        }, 100);
    };
    C_Pro_Re.prototype.criarEntidadePersonalizados = function (Entidade) {
        var listaOrdem = [];
        if (!Entidade.Campos_Valor) {
            Entidade.Campos_Valor = [];
        }
        $("[moura-personalizado-campo]").each(function (index, element) {
            var campo = parseInt($(element).attr("moura-personalizado-campo"));
            var encontrado;
            for (var x = 0; x < Entidade.Campos_Valor.length; x++) {
                if (Entidade.Campos_Valor[x].Campo == campo) {
                    encontrado = Entidade.Campos_Valor[x];
                    break;
                }
            }
            if (!encontrado) {
                encontrado = {};
                encontrado.Campo = campo;
                encontrado.Produto = Entidade.Codigo;
            }
            listaOrdem.push(encontrado);
        });
        for (var x = 0; x < listaOrdem.length; x++) {
            if (listaOrdem[x].Produto != undefined) {
                var parametros = {
                    codCampo: listaOrdem[x].Campo,
                    item: listaOrdem[x].Itemdata
                };
                var retorno = this.ExecutarFuncaoServerSideSynch("GetByItemPersonalizado", parametros);
                if (retorno && retorno.Descricao) {
                    listaOrdem[x].Valor = retorno.Descricao;
                }
            }
        }
        Entidade.Campos_Valor = listaOrdem;
    };
    C_Pro_Re.prototype.configuracoesCamposIniciais = function () {
        try {
            this.txtProcuraReferencia.Visible = false;
            this.txtProcuraImportacao.Visible = false;
            if (String.IsNullOrWhiteSpace(this.txtReferencia.GetText())) {
                this.lblCadastrado.Visible = false;
            }
            this.GetScope()["Entity"].Data_Vigencia = new Date();
            this.cboTaxaTributaria.Visible = this.ExecutarFuncaoServerSideSynch("GetEcfTaxaTributaria", {});
            this.cboIAT.SetSelectedIndex(0);
            var unidadePadrao = this.ExecutarFuncaoServerSideSynch("GetConfigUnidadePadrao", {});
            (unidadePadrao.toLowerCase() == "#nenhuma") ? this.GetScope()["Entity"].Unidade = "" : this.GetScope()["Entity"].Unidade = unidadePadrao;
            //VISIBLE AND DISABLED
            this.txtCodReferencia.Visible = ValoresSismoura.UsarCadastroReferencia;
            this.txtCodReferencia.Obrigatorio = ValoresSismoura.UsarCadastroReferencia;
            this.AgpRef.Visible = ValoresSismoura.UsarCadastroReferencia;
            this.AgpRef.Obrigatorio = ValoresSismoura.UsarCadastroReferencia;
            this.txtReferencia.Disabled = ValoresSismoura.UsarCadastroReferencia;
            this.txtModelo.Visible = ValoresSismoura.UsarModelo;
            this.Tab.AlterarVisibleAba("AbaCustos", ValoresSismoura.ProdutoComposto);
            this.txtPrecoCusto.Disabled = ValoresSismoura.ProdutoComposto;
            var conceitoPreco = this.ExecutarFuncaoServerSideSynch("GetConfigConceitoPreco", {});
            (conceitoPreco == "PREÇO POR FORA") ? this.txtMargem.SetTextLabelControl("MarkUp %") : this.txtMargem.SetTextLabelControl("Margem %");
            var utilizarCampoLinha = this.ExecutarFuncaoServerSideSynch("GetConfigUtilizarCampoLinha", {});
            this.txtLinha.Visible = utilizarCampoLinha;
            this.txtEstoque.Disabled = !ValoresSismoura.ModificarEstoqueCadPro;
            this.Tab.AlterarVisibleAba("AbaCustos", ValoresSismoura.ConfiguracoesRetaguarda.Produto_Composto);
            this.Tab.AlterarVisibleAba("AbaEcommerce", ValoresSismoura.EstabelecimentoEcommerce);
            this.txtDecreto.Visible = ValoresSismoura.InformarDecreto;
            if (ValoresSismoura.OrcUtilizarConversaoUnidProduto) {
                this.cboUnidadeConversao.Visible = true;
                this.cboCalculo.Visible = true;
                this.txtFatorConversao.Visible = true;
                this.txtCustoConversao.Visible = true;
                this.txtVendaConversao.Visible = true;
                this.grdConversao.Visible = true;
                this.txtPeso.Visible = false;
                this.cboConvUndNf.Visible = true;
            }
            else {
                this.cboUnidadeConversao.Visible = false;
                this.cboCalculo.Visible = false;
                this.txtFatorConversao.Visible = false;
                this.txtCustoConversao.Visible = false;
                this.txtVendaConversao.Visible = false;
                this.grdConversao.Visible = false;
                this.txtPeso.Visible = true;
                this.cboConvUndNf.Visible = false;
            }
            this.optTipoCalculo.SetValue("P");
            this.GetScope().$applyAsync();
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.configuracoesGridsIniciais = function () {
        // this.preencherGridPersonalizados(0);
        this.criarEntidadePersonalizados({});
        this.preencherListaPreco(0, "");
        this.preencherGridImpostos(0);
    };
    //private preencherGridPersonalizados(codProduto: number) {
    //    try {
    //        let parametros: any = {
    //            codProduto: codProduto
    //        };
    //        this.Personalizados = this.ExecutarFuncaoServerSideSynch("PreencherPersonalizados", parametros);
    //        this.grdPersonalizados.PreencherGrid(this.Personalizados);
    //    } catch (ex) {
    //        LogarException(ex);
    //    }
    //}
    C_Pro_Re.prototype.preencherListaPreco = function (codigo, referencia) {
        try {
            var parametros = void 0;
            if (codigo > 0 && this.Precos.length > 0) {
                parametros = {
                    codigoProduto: codigo,
                    listas: this.Precos
                };
                this.Precos = this.ExecutarFuncaoServerSideSynch("PreencherListaPrecoProduto", parametros);
            }
            else {
                parametros = {
                    codigo: codigo,
                    referencia: referencia
                };
                this.Precos = this.ExecutarFuncaoServerSideSynch("PreencherListaPreco", parametros);
            }
            this.grdPrecos.PreencherGrid(this.Precos);
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.preencherGridImpostos = function (codigo) {
        try {
            var parametros = {
                codigo: codigo
            };
            this.Impostos = this.ExecutarFuncaoServerSideSynch("PreencherRegraImposto", parametros);
            this.grdImpostos.PreencherGrid(this.Impostos);
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.preencherGridCustos = function (codigo) {
        try {
            var parametros = {
                codigo: codigo
            };
            this.Custos = this.ExecutarFuncaoServerSideSynch("PreencherCustos", parametros);
            // this.grdCustos.PreencherGrid(this.Custos);
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirFornecedor = function (s, e) {
        try {
            var codFornecedor = this.txtFornecedor.GetText().CNum();
            if (codFornecedor <= 0) {
                MostrarAlerta("Informe um Fornecedor!");
                e.cancelar = true;
            }
            else {
                var fornecedor = e.item;
                fornecedor.Razao_Social = this.txtFornecedor.GetResultado();
                var parametros = {
                    codFornecedor: codFornecedor
                };
                var retorno = this.ExecutarFuncaoServerSideSynch("getDadosFornecedor", parametros);
                if (retorno) {
                    fornecedor.Data_Entrada = retorno.Data_Entrada;
                    fornecedor.Valor_Unitario = retorno.Valor_Unitario;
                    fornecedor.Quantidade = retorno.Quantidade;
                }
            }
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirCustos = function (s, e) {
        try {
            var descricao = this.txtDescricaoCusto.GetText();
            var operacao = this.cboOperacaoCusto.GetValue();
            var tipoValor = this.optTipoCalculo.GetValue();
            var valorCusto = this.txtValorCusto.GetText().CNum();
            if (String.IsNullOrWhiteSpace(descricao)) {
                MostrarAlerta("Informe a Descrição!");
                e.cancelar = true;
                return;
            }
            if (String.IsNullOrWhiteSpace(operacao)) {
                MostrarAlerta("Informe a Operação!");
                e.cancelar = true;
                return;
            }
            if (String.IsNullOrWhiteSpace(tipoValor)) {
                MostrarAlerta("Informe o Tipo!");
                e.cancelar = true;
                return;
            }
            if (valorCusto <= 0) {
                MostrarAlerta("Informe o Valor!");
                e.cancelar = true;
                return;
            }
            var custo = e.item;
            custo.Tipo_Valor = tipoValor;
            (tipoValor == "P") ? custo.Tipo_Valor_Text = "Porcentagem" : custo.Tipo_Valor_Text = "Valor";
            (operacao == "D") ? custo.Operacao = "Desconto" : custo.Operacao = "Acréscimo";
            this.optTipoCalculo.SetValue("P");
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirRegraCfop = function (s, e) {
        try {
            var empresa = this.cboEmpresaCfop.GetValue();
            var cfop = this.cboCfop.GetValue();
            var tipoRegra = this.cboRegraCfop.GetValue();
            if (empresa <= 0) {
                MostrarAlerta("Informe a Empresa!");
                e.cancelar = true;
                return;
            }
            if (cfop == "" || cfop == null || cfop == undefined) {
                MostrarAlerta("Informe o CFOP!");
                e.cancelar = true;
                return;
            }
            if (tipoRegra <= 0) {
                MostrarAlerta("Informe a Regra!");
                e.cancelar = true;
                return;
            }
            var regraCfop = e.item;
            for (var x = 0; x < this.Cfops.length; x++) {
                if (regraCfop.Codigo_Empresa == this.Cfops[x].Codigo_Empresa && regraCfop.CFOP == this.Cfops[x].CFOP) {
                    MostrarAlerta("Não é possível inserir esta regra de CFOP pois já existe uma regra para este CFOP.");
                    e.cancelar = true;
                    return;
                }
            }
            regraCfop.Descricao_Empresa = this.cboEmpresaCfop.GetText();
            regraCfop.Descricao_Regra_Imposto = this.cboRegraCfop.GetText();
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirIvaPauta = function (s, e) {
        try {
            var empresa = this.cboEmpresaIva.GetValue();
            var estado = this.cboEstadoIva.GetValue();
            var iva = this.txtIvaPauta.GetText().CNum();
            var pauta = this.txtPautaValor.GetText().CNum();
            if (empresa <= 0) {
                MostrarAlerta("Informe a Empresa!");
                e.cancelar = true;
                return;
            }
            if (String.IsNullOrWhiteSpace(estado)) {
                MostrarAlerta("Informe o Estado!");
                e.cancelar = true;
                return;
            }
            if (iva <= 0 && pauta <= 0) {
                MostrarAlerta("Informe um valor para o IVA ou Pauta!");
                e.cancelar = true;
                return;
            }
            else if (iva > 0 && pauta > 0) {
                MostrarAlerta("Não é possível inserir um valor para o IVA e Pauta no mesmo Estado!");
                e.cancelar = true;
                return;
            }
            var produtoIvaPauta = e.item;
            for (var x = 0; x < this.Ivas.length; x++) {
                if (produtoIvaPauta.Codigo_Empresa == this.Ivas[x].Codigo_Empresa && produtoIvaPauta.Codigo_Estado == this.Ivas[x].Codigo_Estado) {
                    this.Ivas[x].Iva = produtoIvaPauta.Iva;
                    this.Ivas[x].Pauta = produtoIvaPauta.Pauta;
                    e.cancelar = true;
                    return;
                }
            }
            produtoIvaPauta.Descricao_Empresa = this.cboEmpresaIva.GetText();
            produtoIvaPauta.Descricao_Estado = this.cboEstadoIva.GetValue();
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirConversao = function (s, e) {
        try {
            var un = this.cboUnidadeConversao.GetValue();
            var calculo = this.cboCalculo.GetValue();
            var fator = this.txtFatorConversao.GetText().CNum();
            var custo = this.txtCustoConversao.GetText().CNum();
            if (String.IsNullOrWhiteSpace(un)) {
                MostrarAlerta("Informe a Unidade!");
                e.cancelar = true;
                return;
            }
            if (String.IsNullOrWhiteSpace(calculo)) {
                MostrarAlerta("Informe o Cálculo!");
                e.cancelar = true;
                return;
            }
            if (fator <= 0) {
                MostrarAlerta("Informe o Fator!");
                e.cancelar = true;
                return;
            }
            if (custo <= 0) {
                MostrarAlerta("Informe o Custo!");
                e.cancelar = true;
                return;
            }
            var fatorConversao = e.item;
            for (var x = 0; x < this.Conversoes.length; x++) {
                if (fatorConversao.Unidade == this.Conversoes[x].Unidade) {
                    this.Conversoes[x] = fatorConversao;
                    e.cancelar = true;
                    return;
                }
            }
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClickIncluirProduto = function (s, e) {
        var cor = this.txtCor.GetText().CNum();
        var tamanho = this.txtTamanho.GetText();
        if (cor <= 0) {
            MostrarAlerta("Informe a Cor!");
            e.cancelar = true;
            return;
        }
        if (String.IsNullOrWhiteSpace(tamanho)) {
            MostrarAlerta("Informe o Tamanho!");
            e.cancelar = true;
            return;
        }
        var nomeCor = this.txtCor.GetResultado();
        var produto = e.item;
        for (var x = 0; x < this.Produtos.length; x++) {
            if (produto.Codigo === this.Produtos[x].Codigo) {
                this.Produtos[x] = produto;
                this.Produtos[x].Cor = nomeCor;
                e.cancelar = true;
                return;
            }
        }
        if (produto.Codigo == null || produto.Codigo == undefined) {
            produto.Codigo = 0;
        }
        produto.Cor = nomeCor;
    };
    C_Pro_Re.prototype.OnGrdProdutosCellPrepared = function (s, e) {
        try {
            if (e.rowType == "texto" && e.data) {
                var inativo = "" + e.data["Inativo"];
                if (inativo == "S") {
                    e.cellElement.css("color", "red");
                }
            }
        }
        catch (ex) {
        }
    };
    C_Pro_Re.prototype.OnClickBtnNovo = function (s, e) {
        e.processOnServer = false;
        this.LimparCampos();
        this.txtCodReferencia.Limpar();
    };
    C_Pro_Re.prototype.LimparCampos = function () {
        this.GetScope()["Entity"] = {};
        this.txtProcuraReferencia.Limpar();
        this.lblCadastrado.Text = "";
        this.Fornecedores = [];
        this.Impostos = [];
        this.Precos = [];
        this.Personalizados = [];
        this.Cfops = [];
        this.Ivas = [];
        this.Conversoes = [];
        this.Produtos = [];
        this.Produto = {};
        this.Custos = [];
        this.Custo = {};
        this.optTipoCalculo.SetValue("P");
        //Se o campo referência não for vazio ele limpa tudo
        if (String.IsNullOrWhiteSpace(this.txtReferencia.GetText())) {
            this.LimparCamposGrid();
        }
        this.configuracoesCamposIniciais();
        this.configuracoesGridsIniciais();
        this.RefreshAngular();
        this.hdnRespostaDataVigencia.value = "0";
        this.hdnRespostaCodBarra.value = "0";
        this.hdnRespostaCodBarraLista.value = "0";
    };
    C_Pro_Re.prototype.LimparCamposGrid = function () {
        this.txtCodigoProduto.Limpar();
        this.txtCodigoBarras.Limpar();
        this.txtCor.Limpar();
        this.txtTamanho.Limpar();
        this.txtEstoqueMinimo.Limpar();
        this.txtEstoque.Limpar();
        this.txtObservacao.Limpar();
    };
    C_Pro_Re.prototype.OnPesquisouCodigoProduto = function (s, e) {
        var produto = this.txtCodigoProduto.GetText().CNum();
        var igual = false;
        var entityProduto = {};
        if (produto > 0 && this.Produtos.length > 0) {
            for (var x = 0; x < this.Produtos.length; x++) {
                if (produto === this.Produtos[x].Codigo) {
                    igual = true;
                    entityProduto = this.Produtos[x];
                }
            }
            if (!igual) {
                MostrarAlerta("Produto não cadastrado para essa referência!");
                this.txtCodigoProduto.Limpar();
                this.txtCodigoProduto.Focus();
            }
            else {
                this.Produto = entityProduto;
            }
        }
    };
    C_Pro_Re.prototype.OnClickBtnGravar = function (s, e) {
        e.processOnServer = false;
        this.Gravar();
    };
    C_Pro_Re.prototype.Gravar = function () {
        try {
            var Entity = this.GetScope()["Entity"];
            Entity.Cor_Modelo = this.txtCodReferencia.GetText().CNum();
            if (this.OnAntesGravar(Entity)) {
                if (!this.lblCadastrado.Visible) {
                    for (var x = 0; x < this.Produtos.length; x++) {
                        if (typeof this.Produtos[x].Data_Alteracao == 'string') {
                            this.Produtos[x].Data_Alteracao = this.Produtos[x].Data_Alteracao.toString().ToDate();
                        }
                        if (typeof this.Produtos[x].Data_Cadastro == 'string') {
                            this.Produtos[x].Data_Cadastro = this.Produtos[x].Data_Cadastro.toString().ToDate();
                        }
                    }
                }
                for (var x = 0; x < this.Produtos.length; x++) {
                    if (this.Produtos[x].Codigo == null) {
                        this.Produtos[x].Codigo = 0;
                    }
                    this.Produtos[x].Cor_Modelo = this.txtCodReferencia.GetText().CNum();
                }
                this.preencherProdutoPreco(Entity);
                this.preencherFornecedor(Entity);
                this.preencherCustos(Entity);
                //this.preencherPersonalizado(Entity);
                this.preencherImposto(Entity);
                this.preencherRegraCfop(Entity);
                this.preencherProdutoUnidadeConversao(Entity);
                var parametros = {
                    produtoJSON: JSON.stringify(Entity),
                    produtos: this.Produtos,
                    tela: ValoresSismoura.NomeTela,
                    codUsuario: ValoresSismoura.UsuarioLogado
                };
                var retorno = this.ExecutarFuncaoServerSideSynch("Gravar", parametros);
                if (retorno == "Sucesso") {
                    MostrarMensagem("Registro gravado com sucesso!");
                    this.LimparCampos();
                    this.txtCodReferencia.Limpar();
                }
                else {
                    MostrarAlerta("Erro ao gravar o registro!");
                }
            }
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnAntesGravar = function (Entity) {
        try {
            //VALIDAÇÕES
            if (ValoresSismoura.UsarCadastroReferencia) {
                if (this.txtCodReferencia.GetText().CNum() <= 0) {
                    MostrarAlerta("O campo Referência não pode ser vazio!");
                    return false;
                }
            }
            else {
                if (String.IsNullOrWhiteSpace(Entity.Referencia)) {
                    MostrarAlerta("O campo Referência não pode ser vazio!");
                    return false;
                }
            }
            if (String.IsNullOrWhiteSpace(Entity.Nome)) {
                MostrarAlerta("O campo Descrição é obrigatório!");
                return false;
            }
            if (this.txtLinha.Visible) {
                if (Entity.Linha <= 0) {
                    MostrarAlerta("O campo Linha não pode ser nulo!");
                    return false;
                }
            }
            if (String.IsNullOrWhiteSpace(Entity.Unidade)) {
                MostrarAlerta("O campo Unidade não pode ser vazio!");
                return false;
            }
            Entity.Data_Vigencia = ConvertToDate(Entity.Data_Vigencia);
            if (Entity.Data_Vigencia) {
                var dataVigencia = new Date(Entity.Data_Vigencia.getFullYear(), Entity.Data_Vigencia.getMonth(), Entity.Data_Vigencia.getDate());
                var dataAgora = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate());
                if (dataVigencia > dataAgora) {
                    MostrarAlerta("O campo Data de Vigência não pode ser maior que a data de hoje!");
                    return false;
                }
                else if (dataVigencia < dataAgora) {
                    if (this.hdnRespostaDataVigencia.value.CNum() != 1) {
                        MsgBoxJS("O campo Data de Vigência está menor que a data de hoje! Deseja atualizar?", MsgBoxOptions.YesNo, MsgBoxIcon.Question, $.proxy(this.OnRespostaDataVigencia, this));
                        return false;
                    }
                }
            }
            else {
                MostrarAlerta("O campo Data de Vigência não pode ser nulo!");
                return false;
            }
            if (Entity.Preco_Produto <= 0) {
                MostrarAlerta("É necessário informar o preço de venda do produto!");
                return false;
            }
            if (Entity.Grupo <= 0) {
                MostrarAlerta("Preencha o campo grupo!");
                return false;
            }
            if (this.cboTaxaTributaria.Visible) {
                if (!Entity.Taxa_Tributaria) {
                    MostrarAlerta("Informe a Taxa Tributária!");
                    return false;
                }
            }
            //if (!this.lblCadastrado.Visible) {
            if (!this.Produtos || this.Produtos.length <= 0) {
                MostrarAlerta("Informe ao menos um Produto na Grade!");
                return false;
            }
            //}
            if (this.ExecutarFuncaoServerSideSynch("GetConfigGerarCodigoBarra", {})) {
                var gerarCod = false;
                if (String.IsNullOrWhiteSpace(Entity.Codigo_Barra)) {
                    if (this.hdnRespostaCodBarra.value.CNum() != 1) {
                        MsgBoxJS("O produto não possui código de barras. Deseja que o sistema gere?", MsgBoxOptions.YesNo, MsgBoxIcon.Question, $.proxy(this.OnRespostaCodigoBarraProduto, this));
                        return false;
                    }
                }
                if (!this.lblCadastrado.Visible) {
                    for (var x = 0; x < this.Produtos.length; x++) {
                        if (String.IsNullOrWhiteSpace(this.Produtos[x].Codigo_Barra)) {
                            gerarCod = true;
                            x = this.Produtos.length;
                        }
                    }
                    if (gerarCod) {
                        if (this.hdnRespostaCodBarraLista.value.CNum() != 1) {
                            MsgBoxJS("Possui produto na grade sem código de barras. Deseja que o sistema gere?", MsgBoxOptions.YesNo, MsgBoxIcon.Question, $.proxy(this.OnRespostaCodigoBarraListaProduto, this));
                            return false;
                        }
                    }
                }
            }
            var parametros = {
                listaImposto: this.Impostos
            };
            var isObrigatoriedadeImposto = this.ExecutarFuncaoServerSideSynch("VerificarObrigatoriedadeImposto", parametros);
            if (!String.IsNullOrWhiteSpace(isObrigatoriedadeImposto)) {
                MostrarAlerta(isObrigatoriedadeImposto);
                return false;
            }
            this.criarEntidadePersonalizados(Entity);
            return true;
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnRespostaDataVigencia = function (result) {
        if (result.Resultado == MsgBoxResult.Yes) {
            this.GetScope()["Entity"].Data_Vigencia = new Date();
            this.GetScope().$applyAsync();
        }
        this.hdnRespostaDataVigencia.value = "1";
        this.Gravar();
    };
    C_Pro_Re.prototype.OnRespostaCodigoBarraProduto = function (result) {
        if (result.Resultado == MsgBoxResult.Yes) {
            this.GetScope()["Entity"].AuxIsGerarCodBarras = true;
            this.GetScope().$applyAsync();
        }
        this.hdnRespostaCodBarra.value = "1";
        this.Gravar();
    };
    C_Pro_Re.prototype.OnRespostaCodigoBarraListaProduto = function (result) {
        if (result.Resultado == MsgBoxResult.Yes) {
            for (var x = 0; x < this.Produtos.length; x++) {
                if (String.IsNullOrWhiteSpace(this.Produtos[x].Codigo_Barra)) {
                    this.Produtos[x].AuxIsGerarCodBarras = true;
                }
                else {
                    this.Produtos[x].AuxIsGerarCodBarras = false;
                }
            }
            this.GetScope().$applyAsync();
        }
        this.hdnRespostaCodBarraLista.value = "1";
        this.Gravar();
    };
    C_Pro_Re.prototype.preencherProdutoPreco = function (Entity) {
        if (this.Precos.length > 0) {
            var produtosPrecos = this.Precos;
            var precosExistente = Entity.Precos;
            Entity.Precos = [];
            for (var x = 0; x < produtosPrecos.length; x++) {
                var novoPreco = {};
                var precoGrid = void 0;
                if (!precosExistente)
                    precosExistente = [];
                for (var y = 0; y < precosExistente.length; y++) {
                    if (precosExistente[y].Lista_Preco == produtosPrecos[x].Codigo_Lista) {
                        novoPreco = precosExistente[y];
                        y = precosExistente.length;
                    }
                }
                precoGrid = produtosPrecos[x];
                novoPreco.Comissao = precoGrid.Comissao_Produto_Preco;
                novoPreco.Lista_Preco = precoGrid.Codigo_Lista;
                novoPreco.Valor = precoGrid.Valor_Produto_Preco;
                novoPreco.Qtde_Minima = precoGrid.Quantidade_Minima_Produto_Preco;
                novoPreco.Margem = precoGrid.Margem_Produto_Preco;
                novoPreco.Produto = precoGrid.Produto;
                novoPreco.Preco_Custo = precoGrid.Custo_Produto_Preco;
                Entity.Precos.push(novoPreco);
            }
            this.GetScope().$applyAsync();
        }
    };
    C_Pro_Re.prototype.preencherFornecedor = function (Entity) {
        var fornecedores = this.Fornecedores;
        var fornecedoresExistente = Entity.Fornecedores;
        Entity.Fornecedores = [];
        for (var x = 0; x < fornecedores.length; x++) {
            var novoFornecedor = {};
            var fornecedorGrid = void 0;
            if (!fornecedoresExistente)
                fornecedoresExistente = [];
            for (var y = 0; y < fornecedoresExistente.length; y++) {
                if (fornecedoresExistente[y].Codigo == fornecedores[x].Codigo_Fornecedor) {
                    novoFornecedor = fornecedoresExistente[y];
                    y = fornecedoresExistente.length;
                }
            }
            fornecedorGrid = fornecedores[x];
            novoFornecedor.Fornecedor = fornecedorGrid.Codigo_Fornecedor;
            Entity.Fornecedores.push(novoFornecedor);
        }
        this.GetScope().$applyAsync();
    };
    C_Pro_Re.prototype.preencherCustos = function (Entity) {
        //if (this.Custos.length > 0) {
        var custos = this.Custos;
        Entity.Custos = [];
        //let custosExistente = Entity.Custos;
        //Entity.Fornecedores = [];
        for (var x = 0; x < custos.length; x++) {
            //let novoCusto = <SiSMoura.Core.Entity.Produto_Custo>{};
            //let custoGrid: SiSMoura.Core.Entity.Produto_Custo = <SiSMoura.Core.Entity.Produto_Custo>{};
            //if (!custosExistente)
            //    custosExistente = [];
            //for (var y = 0; y < custosExistente.length; y++) {
            //    if (custosExistente[y].Codigo == custos[x].Codigo) {
            //       // novoCusto = custosExistente[y];
            //       // y = custosExistente.length;
            //        Entity.Custos.push(custosExistente[y])
            //    }
            //}
            //custoGrid = custos[x];
            /*novoCusto.Descricao = custoGrid.Descricao;
            novoCusto.Operacao = custoGrid.Operacao;
            novoCusto.Tipo_Valor = custoGrid.Tipo_Valor;
            novoCusto.Valor = custoGrid.Valor;*/
            // if (custosExistente.length == 0) {
            Entity.Custos.push(custos[x]);
            // }
        }
        this.GetScope().$applyAsync();
        // }
    };
    //private preencherPersonalizado(Entity: SiSMoura.Core.Entity.Produto) {
    //    if (this.Personalizados.length > 0) {
    //        const personalizados: SiSMoura.Core.Entity.ProdutoCamposPersonalizadosRetorno[] = this.Personalizados;
    //        let personalizadosExistente = Entity.Campos_Valor;
    //        Entity.Campos_Valor = [];
    //        for (var x = 0; x < personalizados.length; x++) {
    //            let novoPersonalizado = <SiSMoura.Core.Entity.Campo_Produto_Valor>{};
    //            let personalizadoGrid: SiSMoura.Core.Entity.ProdutoCamposPersonalizadosRetorno;
    //            if (!personalizadosExistente)
    //                personalizadosExistente = [];
    //            for (var y = 0; y < personalizadosExistente.length; y++) {
    //                if (personalizadosExistente[y].Codigo == personalizados[x].Codigo) {
    //                    novoPersonalizado = personalizadosExistente[y];
    //                    y = personalizadosExistente.length;
    //                }
    //            }
    //            personalizadoGrid = personalizados[x];
    //            novoPersonalizado.Campo = personalizadoGrid.Codigo;
    //            novoPersonalizado.Valor = personalizadoGrid.Valor;
    //            Entity.Campos_Valor.push(novoPersonalizado);
    //        }
    //        this.GetScope().$applyAsync();
    //    }
    //}
    C_Pro_Re.prototype.preencherImposto = function (Entity) {
        if (this.Impostos.length > 0) {
            var impostos = this.Impostos;
            var impostosExistente = Entity.RegrasImposto;
            Entity.RegrasImposto = [];
            for (var x = 0; x < impostos.length; x++) {
                var novoImposto = {};
                var impostoGrid = void 0;
                if (!impostosExistente)
                    impostosExistente = [];
                for (var y = 0; y < impostosExistente.length; y++) {
                    if (impostosExistente[y].Codigo == impostos[x].Codigo) {
                        novoImposto = impostosExistente[y];
                        y = impostosExistente.length;
                    }
                }
                impostoGrid = impostos[x];
                novoImposto.Empresa = impostoGrid.Codigo_Empresa;
                novoImposto.Tipo_Regra_Imposto = impostoGrid.Codigo_Tipo_Regra;
                novoImposto.Pauta_Valor_Money = impostoGrid.Pauta_Valor;
                if (novoImposto.Empresa > 0 && novoImposto.Tipo_Regra_Imposto > 0) {
                    Entity.RegrasImposto.push(novoImposto);
                }
            }
            this.GetScope().$applyAsync();
        }
    };
    C_Pro_Re.prototype.preencherRegraCfop = function (Entity) {
        if (this.Cfops.length > 0) {
            var cfops = this.Cfops;
            var cfopsExistente = Entity.Regras_Imposto_CFOP;
            Entity.Regras_Imposto_CFOP = [];
            for (var x = 0; x < cfops.length; x++) {
                var novoCfop = {};
                var cfopGrid = void 0;
                if (!cfopsExistente)
                    cfopsExistente = [];
                for (var y = 0; y < cfopsExistente.length; y++) {
                    if (cfopsExistente[y].Codigo == cfops[x].Codigo) {
                        novoCfop = cfopsExistente[y];
                        y = cfopsExistente.length;
                    }
                }
                cfopGrid = cfops[x];
                novoCfop.Cfop = cfopGrid.CFOP;
                novoCfop.Tipo_Regra_Imposto = cfopGrid.Tipo_Regra_Imposto;
                novoCfop.Empresa = cfopGrid.Codigo_Empresa;
                Entity.Regras_Imposto_CFOP.push(novoCfop);
            }
            this.GetScope().$applyAsync();
        }
    };
    C_Pro_Re.prototype.preencherProdutoUnidadeConversao = function (Entity) {
        if (this.Conversoes.length > 0) {
            var unidades = this.Conversoes;
            var unidadesExistente = Entity.Unidades_Conversao;
            Entity.Unidades_Conversao = [];
            for (var x = 0; x < unidades.length; x++) {
                var novaUnidade = {};
                var unidadeGrid = void 0;
                if (!unidadesExistente)
                    unidadesExistente = [];
                for (var y = 0; y < unidadesExistente.length; y++) {
                    if (unidadesExistente[y].Id == unidades[x].Id) {
                        novaUnidade = unidadesExistente[y];
                        y = unidadesExistente.length;
                    }
                }
                unidadeGrid = unidades[x];
                novaUnidade.Calculo = unidadeGrid.Calculo;
                novaUnidade.Valor = unidadeGrid.Valor;
                novaUnidade.Preco_Custo = unidadeGrid.Preco_Custo;
                novaUnidade.Preco_Venda = unidadeGrid.Preco_Venda;
                novaUnidade.Unidade = unidadeGrid.Unidade;
                Entity.Unidades_Conversao.push(novaUnidade);
            }
            this.GetScope().$applyAsync();
        }
    };
    C_Pro_Re.prototype.OnClickBtnExcluir = function (s, e) {
        e.processOnServer = false;
        var produto = this.txtCodigoProduto.GetText().CNum();
        if (produto <= 0) {
            MostrarAlerta("Selecione um Produto na grade para excluí-lo!");
            return;
        }
        MsgBoxJS("Deseja realmente excluir o Produto: <b>" + produto.toString() + "</b>?", MsgBoxOptions.YesNo, MsgBoxIcon.Question, $.proxy(this.OnRespostaExcluirRegistro, this));
    };
    C_Pro_Re.prototype.OnRespostaExcluirRegistro = function (result) {
        if (result.Resultado == MsgBoxResult.Yes) {
            this.Excluir(this.txtCodigoProduto.GetText().CNum());
        }
    };
    C_Pro_Re.prototype.Excluir = function (produto) {
        try {
            if (produto > 0) {
                var parametros = {
                    codProduto: produto,
                    tela: ValoresSismoura.NomeTela,
                    codUsuario: ValoresSismoura.UsuarioLogado
                };
                var retorno = "Sucesso";
                retorno = this.ExecutarFuncaoServerSideSynch("Excluir", parametros);
                if (retorno == "Sucesso") {
                    MostrarMensagem("Registro excluído com sucesso!");
                    this.OnDepoisBuscarExistente();
                }
                else {
                    MostrarAlerta("Erro ao excluir o registro!");
                }
            }
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_Pro_Re.prototype.OnClicouCellGrdImpostos = function (s, e) {
        if (e.item) {
            if (e.item.Codigo_Tipo_Regra == null) {
                e.item.Codigo_Tipo_Regra = 0;
            }
        }
    };
    C_Pro_Re.prototype.OnAlterandoItemProduto = function (s, e) {
        if (e.item.Codigo == null) {
            e.item.Codigo = 0;
        }
    };
    return C_Pro_Re;
}(MouraPageAngular));
var c_Pro_Re = new C_Pro_Re;
//# sourceMappingURL=C_Pro_Re.js.map