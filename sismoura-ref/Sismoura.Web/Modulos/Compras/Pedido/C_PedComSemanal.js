var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var C_PedComSemanal = /** @class */ (function (_super) {
    __extends(C_PedComSemanal, _super);
    function C_PedComSemanal() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(C_PedComSemanal.prototype, "lblEmpresaSystextil", {
        get: function () {
            return window['lblEmpresaSystextil_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblDataSystextil", {
        get: function () {
            return window['lblDataSystextil_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblHoraSystextil", {
        get: function () {
            return window['lblHoraSystextil_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtCodigo", {
        get: function () {
            return window['txtCodigo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtDataEmissao", {
        get: function () {
            return window['txtDataEmissao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnInserirProdutos", {
        get: function () {
            return window['btnInserirProdutos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridIntegracaoSystextil", {
        get: function () {
            return window['gridIntegracaoSystextil_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblHora", {
        get: function () {
            return window['lblHora_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblData", {
        get: function () {
            return window['lblData_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblDeposito", {
        get: function () {
            return window['lblDeposito_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblEmpresa", {
        get: function () {
            return window['lblEmpresa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "mdIntegracaoSystextil", {
        get: function () {
            return window['mdIntegracaoSystextil_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnEstoqueFabrica", {
        get: function () {
            return window['btnEstoqueFabrica_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtUltimoPedido", {
        get: function () {
            return window['txtUltimoPedido_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtFornecedor", {
        get: function () {
            return window['txtFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridRetornoPedido", {
        get: function () {
            return window['gridRetornoPedido_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridSubExpandir", {
        get: function () {
            return window['gridSubExpandir_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridCurvaABCRetorno", {
        get: function () {
            return window['gridCurvaABCRetorno_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "mdReprovarPedido", {
        get: function () {
            return window['mdReprovarPedido_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtAreaReprovacao", {
        get: function () {
            return window['txtAreaReprovacao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnGravarReprovacao", {
        get: function () {
            return window['btnGravarReprovacao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnCancelarReprovacao", {
        get: function () {
            return window['btnCancelarReprovacao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnLimpa", {
        get: function () {
            return window['btnLimpa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnGerar", {
        get: function () {
            return window['btnGerar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnCancelarFornecedor", {
        get: function () {
            return window['btnCancelarFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnGravarFornecedor", {
        get: function () {
            return window['btnGravarFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lbDepositoFornecedor", {
        get: function () {
            return window['lbDepositoFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "cboFormaPagamento", {
        get: function () {
            return window['cboFormaPagamento_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lstEmpresaRemessa", {
        get: function () {
            return window['lstEmpresaRemessa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "cboGradeSemanalRetorno", {
        get: function () {
            return window['cboGradeSemanalRetorno_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtPeriodo", {
        get: function () {
            return window['txtPeriodo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnEmail", {
        get: function () {
            return window['btnEmail_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnLimpar", {
        get: function () {
            return window['btnLimpar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnGravar", {
        get: function () {
            return window['btnGravar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridCurvaABC", {
        get: function () {
            return window['gridCurvaABC_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "gridRemessaPedido", {
        get: function () {
            return window['gridRemessaPedido_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "btnMarcarTodos", {
        get: function () {
            return window['btnMarcarTodos_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtFornecedorRemessa", {
        get: function () {
            return window['txtFornecedorRemessa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtCompradorRemessa", {
        get: function () {
            return window['txtCompradorRemessa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtHoraLimiteResp", {
        get: function () {
            return window['txtHoraLimiteResp_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lblPrazoRespostaDia", {
        get: function () {
            return window['lblPrazoRespostaDia_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "txtPrazoResposta", {
        get: function () {
            return window['txtPrazoResposta_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "lstEmpresaRetorno", {
        get: function () {
            return window['lstEmpresaRetorno_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "cboGradeSemanalRemessa", {
        get: function () {
            return window['cboGradeSemanalRemessa_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "EnvioEmail", {
        get: function () {
            return window['EnvioEmail_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "mdSubExpandir", {
        get: function () {
            return window['mdSubExpandir_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "mdDadosFornecedor", {
        get: function () {
            return window["mdDadosFornecedor_Object"];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "chkFornecedor", {
        get: function () {
            return window['chkFornecedor_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "tab", {
        get: function () {
            return window['tab_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "Retorno", {
        get: function () {
            if (!this.GetScope()["Retornos"]) {
                this.GetScope()["Retornos"] = [];
            }
            return this.GetScope()["Retornos"];
        },
        set: function (value) {
            this.GetScope()["Retornos"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "Remessas", {
        get: function () {
            if (!this.GetScope()["Remessas"]) {
                this.GetScope()["Remessas"] = [];
            }
            return this.GetScope()["Remessas"];
        },
        set: function (value) {
            this.GetScope()["Remessas"] = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_PedComSemanal.prototype, "SubRetorno", {
        get: function () {
            if (!this.GetScope()["Sub"]) {
                this.GetScope()["Sub"] = [];
            }
            return this.GetScope()["Sub"];
        },
        set: function (value) {
            this.GetScope()["Sub"] = value;
        },
        enumerable: true,
        configurable: true
    });
    C_PedComSemanal.prototype.OnPageLoad = function () {
        _super.prototype.OnPageLoad.call(this);
        // se o usuario for franqueador
        if (ValoresSismoura.ConfiguracoesRetaguarda.Usuario_Franqueador) {
            this.tab.AlterarVisibleAba("AbaRetornoPedido", true);
            this.gridRemessaPedido.Grid.SetColunaEditavel("Veiculacao", true);
            this.gridRemessaPedido.Grid.SetColunaEditavel("Quantidade", false);
            this.gridRemessaPedido.Grid.ColunaVisible("Pedido", false);
            this.gridCurvaABC.Visible = false;
            this.gridRemessaPedido.Grid.ColunaVisible("Curva_ABC", false);
            $('#RemessaABC').css('width', '100%');
        }
        else {
            this.isFranqueado();
            this.tab.AlterarVisibleAba("AbaRetornoPedido", false);
            this.linhasQuantidade = new Array();
            this.gridRemessaPedido.Grid.SetColunaEditavel("Veiculacao", false);
            this.gridRemessaPedido.Grid.SetColunaEditavel("Quantidade", true);
            this.gridCurvaABC.Visible = true;
            this.gridRemessaPedido.Grid.ColunaVisible("Curva_ABC", true);
        }
    };
    C_PedComSemanal.prototype.Init = function () {
        var _this = this;
        _super.prototype.Init.call(this);
        var x = {};
        this.onLimparRemessa();
        this.onLimparRetorno();
        this.lstEmpresaRemessa.btnMarcar.Click;
        this.txtDataEmissao.Date = this.DataServidor();
        this.txtUltimoPedido.SetText(this.ExecutarFuncaoServerSideSynch("UltimoPedidoSemanal", x));
        this.txtPrazoResposta.Enabled = false;
        this.txtHoraLimiteResp.Enabled = false;
        if (this.txtDataEmissao) {
            adicionarEventoMoura(this.txtDataEmissao.ValueChanged, function () {
                _this.cboGradeSemanalRemessa.SetSelectedIndex(-1);
                _this.lstEmpresaRemessa.RemoverTodosItens(true);
                _this.txtPrazoResposta.Date = null;
                _this.lblPrazoRespostaDia.Text = "";
                _this.txtHoraLimiteResp.textBoxHorario.SetText(null);
                _this.gridRemessaPedido.Grid.PreencherGrid(null);
            }, this);
        }
        if (this.txtPrazoResposta) {
            adicionarEventoMoura(this.txtPrazoResposta.ValueChanged, this.retornaDiaDaSemana, this);
        }
        if (this.gridRemessaPedido) {
            adicionarEventoMoura(this.gridRemessaPedido.Grid.EditouItemGrade, this.CalcularValor, this);
            adicionarEventoMoura(this.gridRemessaPedido.Grid.SelecionouLinha, this.atualizarCurvaABC, this);
        }
        if (this.lstEmpresaRemessa) {
            adicionarEventoMoura(this.lstEmpresaRemessa.SelectionChanged, function () {
                _this.gridRemessaPedido.Grid.PreencherGrid(null);
            }, this);
        }
        if (this.gridRetornoPedido) {
            adicionarEventoMoura(this.gridRetornoPedido.Grid.ClickBotaoLinha, function (s, e) {
                switch (e.buttonText) {
                    case "+": {
                        _this.ExibeModalSubExpandir(e.data);
                        break;
                    }
                    case "Aprovar": {
                        _this.ExibeModalFornecedor();
                        break;
                    }
                    case "Reprovar": {
                        _this.ExibeModalReprovar();
                        _this.data = e.data;
                        break;
                    }
                }
            }, this);
        }
        if (this.cboGradeSemanalRemessa) {
            adicionarEventoDevExpress(this.cboGradeSemanalRemessa.Combo.TextChanged, this.preencherComboGradeSemanal, this);
        }
        if (this.cboGradeSemanalRetorno) {
            adicionarEventoDevExpress(this.cboGradeSemanalRetorno.Combo.TextChanged, this.preencherComboGradeSemanalRetorno, this);
        }
        if (this.gridRemessaPedido) {
            adicionarEventoMoura(this.gridRemessaPedido.AlterandoItem, this.CalcularValor, this);
            adicionarEventoMoura(this.gridRemessaPedido.Grid.ClickBotaoLinha, this.ClicouBotaoMotivoRemessa, this);
        }
        if (this.txtCompradorRemessa) {
            this.txtCompradorRemessa.SetText(ValoresSismoura.UsuarioLogado.toString());
        }
        if (this.txtPeriodo) {
            this.txtPeriodo.IniciarDataAtual();
        }
        if (this.btnEmail) {
            this.btnEmail.SetEnabled(false);
        }
    };
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    // ---------------------------------------------------------   Métodos --------------------------------------------------------------------
    //implementar
    C_PedComSemanal.prototype.ClicouBotaoMotivoRemessa = function (s, e) {
        switch (e.buttonText) {
            case "Motivo": {
                // está como mensagem, mas alterar para um modal e exibi-lo
                var par = {
                    codigo: e.data.Pedido,
                    empresa: e.data.Empresa
                };
                var motivo = this.ExecutarFuncaoServerSideSynch("RetornaMotivo", par);
                if (motivo != null) {
                    MostrarMensagem("****************MOTIVO: " + motivo + "***************", 10000);
                }
                break;
            }
        }
    };
    // seta valores na grid curva abc de acordo com a linha selecionada
    C_PedComSemanal.prototype.atualizarCurvaABC = function (s, event) {
        var param = {
            empresa: event.data.Empresa,
            produto: event.data.Codigo_Produto,
            dataIni: this.txtDataEmissao.Date
        };
        this.gridCurvaABC.PreencherGrid(this.ExecutarFuncaoServerSideSynch("CurvaABCProduto", param));
    };
    //faz a conta do valor em cima do custo * quantidade automaticamente
    C_PedComSemanal.prototype.CalcularValor = function (s, e) {
        if (e.fieldNameAlterado == 'Quantidade') {
            e.item.Valor = CNum(e.valorAlterado) * e.item.Custo;
            this.linhasQuantidade.push(e.index);
        }
        this.gridRemessaPedido.Grid.Refresh();
    };
    //NUNCA ESQUECER DE SETAR O NGMODEL, NGITEM E NGITEMS, pois será necessário para editar uma coluna
    //seta os produtos selecionados no modal da API Systextil na grade de Remessa
    C_PedComSemanal.prototype.AdicionarColunaGradePedidoRemessa = function () {
        var _this = this;
        this.selecionadas = this.gridIntegracaoSystextil.GetSelectedRowsData;
        var produtos = new Array();
        if (this.selecionadas.length > 0) {
            var listaSystextil = new Array();
            this.selecionadas.forEach(function (selec) {
                produtos.push(CNum(selec.Codigo_Fabrica));
            });
            var par = {
                codigos: produtos
            };
            var listaLinhas = this.ExecutarFuncaoServerSideSynch("NomeLinhaLista", par);
            var linhas = 1;
            listaLinhas.forEach(function (linha) {
                _this.lstEmpresaRemessa.GetValuesNumber().forEach(function (codEmpresa) {
                    for (var i = 0; i < _this.selecionadas.length; i++) {
                        var item = {};
                        if (linha.Tipo_Linha == _this.selecionadas[i].Codigo_Fabrica) {
                            item.Codigo = 0;
                            item.Linha = linha.Nome;
                            item.Codigo_Linha = linha.Codigo;
                            par = {
                                codigo: _this.systextilList[i].local_Deposito
                            };
                            item.Id = linhas;
                            item.Empresa = codEmpresa;
                            item.Deposito = _this.systextilList[i].local_Deposito;
                            item.Local_Deposito = _this.ExecutarFuncaoServerSideSynch("NomeDeposito", par);
                            par = {
                                codigo: _this.selecionadas[i].Codigo_Fabrica
                            };
                            item.Fornecedor = _this.selecionadas[i].Fornecedor;
                            item.Venda = _this.ExecutarFuncaoServerSideSynch("PrecoDeVendaDoProduto", par);
                            item.Colecao = _this.selecionadas[i].Colecao;
                            item.Codigo_Produto = _this.selecionadas[i].Codigo_Fabrica;
                            item.Codigo_Fabrica = _this.selecionadas[i].Codigo_Fabrica;
                            item.Descricao_Produto = _this.selecionadas[i].Descricao_Peca;
                            item.Custo = 0;
                            item.Situacao_Atual = "Remessa";
                            item.Veiculacao = null;
                            item.Lote = _this.selecionadas[i].Lote;
                            item.Embalagem = _this.selecionadas[i].Embalagem;
                            item.Empenhado = _this.selecionadas[i].Empenhado;
                            item.PACK = _this.selecionadas[i].PACK;
                            item.Sortimento = _this.selecionadas[i].Sortimento;
                            item.Quantidade = 0;
                            item.Valor = 0;
                            listaSystextil.push(item);
                            linhas++;
                        }
                    }
                });
            });
            this.Remessas = listaSystextil;
            this.gridRemessaPedido.Grid.GroupBy("Fornecedor");
            this.gridRemessaPedido.Grid.GroupBy("Empresa");
            this.gridRemessaPedido.Grid.GroupBy("Linha");
            this.gridRemessaPedido.Grid.GroupBy("Deposito");
            this.gridRemessaPedido.Grid.OrderBy("Fornecedor", "asc");
            this.mdIntegracaoSystextil.Hide();
            this.RefreshAngular();
        }
        else {
            MostrarAlerta("Selecione, pelo menos, 1 produto!");
        }
    };
    //fecha a modal do fornecedor
    C_PedComSemanal.prototype.modalFornecedorCancelar = function () {
        this.mdDadosFornecedor.Hide();
    };
    //fecha a modal de recusa
    C_PedComSemanal.prototype.modalRecusaCancelar = function () {
        this.mdReprovarPedido.Hide();
    };
    //preeche o combo grade semanal e popula a lista de empresas 
    //de acordo com as empresas relacionadas ao dia da grade semanal
    C_PedComSemanal.prototype.preencherComboGradeSemanal = function () {
        this.lstEmpresaRemessa.RemoverTodosItens(true);
        this.gridRemessaPedido.Grid.PreencherGrid(null);
        var gradeSemanalRemessa = this.cboGradeSemanalRemessa.GetSelectedIndex() + 1;
        var parametros = {
            dia: gradeSemanalRemessa,
            usuario: -1
        };
        var empresas = this.ExecutarFuncaoServerSideSynch("ListaEmpresasRelacionadasAoDia", parametros);
        if (empresas.length == 0) {
            MostrarAlerta("Não há empresa para esta grade!");
            this.txtPrazoResposta.Enabled = false;
            this.txtHoraLimiteResp.Enabled = false;
            this.txtPrazoResposta.Date = null;
            this.txtHoraLimiteResp.textBoxHorario.SetText("");
            this.lblPrazoRespostaDia.Text = "";
        }
        else {
            for (var _i = 0, empresas_1 = empresas; _i < empresas_1.length; _i++) {
                var empresa = empresas_1[_i];
                parametros = {
                    codigo: empresa
                };
                this.lstEmpresaRemessa.AdicionarItem(this.ExecutarFuncaoServerSideSynch("NomeEmpresa", parametros), empresa);
            }
        }
        this.preencheHoraLimitePrazoResposta();
    };
    //preeche o combo grade semanal e popula a lista de empresas 
    //de acordo com as empresas relacionadas ao intervalo das datas da grade semanal
    C_PedComSemanal.prototype.preencherComboGradeSemanalRetorno = function () {
        this.lstEmpresaRetorno.RemoverTodosItens(true);
        var gradeSemanalRetorno = this.cboGradeSemanalRetorno.GetSelectedIndex() + 1;
        var parametros = {
            inicio: this.txtPeriodo.textBoxCalendarioInicio.GetDate(),
            fim: this.txtPeriodo.textBoxCalendarioFim.GetDate(),
            dia: gradeSemanalRetorno
        };
        var empresas = this.ExecutarFuncaoServerSideSynch("ListaEmpresasIntervaloData", parametros);
        if (empresas.length == 0) {
            MostrarAlerta("Não há empresa para esta grade!");
        }
        else {
            for (var _i = 0, empresas_2 = empresas; _i < empresas_2.length; _i++) {
                var empresa = empresas_2[_i];
                parametros = {
                    codigo: empresa
                };
                this.lstEmpresaRetorno.AdicionarItem(this.ExecutarFuncaoServerSideSynch("NomeEmpresa", parametros), empresa);
            }
        }
    };
    // este método abre o modal da API Systextil e carrega todos os produtos contidos nela
    // talvez sofrerá alterações devido a api estar incompleta.
    C_PedComSemanal.prototype.showIntegracaoSystextil = function () {
        var _this = this;
        if (this.lstEmpresaRemessa.GetTexts().length > 0 && this.chkFornecedor.GetValues().length > 0) {
            var par = {
                fornecedores: this.chkFornecedor.GetValues()
            };
            //carrega os produtos da api vinculados aos fornecedores selecionados.
            var produtosFornecedores = this.ExecutarFuncaoServerSideSynch("ProdutoFornecedor", par);
            if (produtosFornecedores.length > 0) {
                this.mdIntegracaoSystextil.Show();
                var systextilList;
                var lista = {
                    empresas: this.lstEmpresaRemessa.GetTexts()
                };
                par = {
                    codigo: this.chkFornecedor.GetValues()
                };
                var param = {};
                this.lblEmpresaSystextil.Text = this.ExecutarFuncaoServerSideSynch("retornaLabelEmpresaSystextil", lista);
                this.lblDataSystextil.Text = this.DataServidor().FormataData();
                this.lblHoraSystextil.Text = this.DataServidor().FormataHoraSismoura();
                this.lblDeposito.Text = this.ExecutarFuncaoServerSideSynch("DescricaoDeposito", par);
                abrirEspera("Aguarde, Estamos carregando os produtos da API Systextil!");
                this.ExecutarFuncaoServerSideAsynch("ProdutosSystextil", param, function (d) {
                    try {
                        systextilList = GetRetornoAJAX(d);
                        var listItem = new Array();
                        var item = {};
                        var id = 0;
                        systextilList.forEach(function (systextil) {
                            produtosFornecedores.forEach(function (pf) {
                                if (systextil.codigo_VestCasa == pf.Produto) {
                                    item = {};
                                    //par = {
                                    //    codigo: systextil.deposito
                                    //}
                                    id += 1;
                                    //item.Deposito = this.ExecutarFuncaoServerSideSynch(
                                    //    "NomeDeposito", par);
                                    item.Deposito = systextil.deposito;
                                    item.Fornecedor = pf.Fornecedor;
                                    item.Id = id;
                                    item.Colecao = 0; // não tem esse campo
                                    item.Codigo_Fabrica = systextil.codigo_VestCasa;
                                    item.Descricao_Peca = systextil.narrativa;
                                    item.Lote = 0; //não tem esse campo
                                    item.Embalagem = 0; // não tem esse campo
                                    item.Empenhado = 0; //não tem esse campo
                                    item.PACK = 0;
                                    item.Estoque_Atual = systextil.qtde_Estoque_Atu;
                                    item.Sortimento = ''; // não tem esse campo
                                    listItem.push(item);
                                }
                            });
                        });
                        _this.gridIntegracaoSystextil.PreencherGrid(listItem);
                        _this.systextilList = systextilList;
                    }
                    catch (ex) {
                        LogarException(ex);
                    }
                    finally {
                        fecharEspera();
                    }
                }, function (erro) {
                    LogarExceptionAjax(erro);
                    fecharEspera();
                }, this);
            }
            else {
                if (this.chkFornecedor.GetValues().length > 1) {
                    MostrarAlerta("Os Fornecedores não possuem produtos cadastrados!");
                }
                else {
                    MostrarAlerta("O Fornecedor não possui produto cadastrado!");
                }
            }
        }
        else {
            MostrarAlerta("Selecione ao menos 1 Empresa e 1 Fornecedor!");
        }
    };
    //este método preencherá automaticamente os campos Hora Limite e Prazo Resposta.
    C_PedComSemanal.prototype.preencheHoraLimitePrazoResposta = function () {
        if (this.lstEmpresaRemessa.GetAllValues().length != 0) {
            var param = {
                codigo: this.lstEmpresaRemessa.GetAllValues()
            };
            var pedido = this.ExecutarFuncaoServerSideSynch("ObterEmpresa", param);
            if (pedido != null) {
                param = {
                    dia: this.cboGradeSemanalRemessa.GetSelectedIndex(),
                    empresa: this.lstEmpresaRemessa.GetAllValues()[0],
                    diaEmissao: this.txtDataEmissao.Date.getDate(),
                    mes: this.txtDataEmissao.Date.getMonth() + 1,
                    ano: this.txtDataEmissao.Date.getFullYear()
                };
                //este método retorna se o dia será feriado ou não.
                var isFeriado = this.ExecutarFuncaoServerSideSynch("ValidaData", param);
                //este método calcula a nova data para setar no prazo resposta
                var data = this.ExecutarFuncaoServerSideSynch("InformaData", param);
                // uma forma beeem feia de setar os minutos da hora
                // porém fiz o cenário mais "fácil", caso consiga fazer algo melhor
                // favor implementar
                if (pedido.Hora.Minutes < 10) {
                    pedido.Hora = pedido.Hora.Hours + ":0" + pedido.Hora.Minutes;
                }
                else {
                    pedido.Hora = pedido.Hora.Hours + ":" + pedido.Hora.Minutes;
                }
                // faz a setagem dos campos como editável ou não caso a data seja feriado ou não.
                if (isFeriado) {
                    MostrarAlerta("Esta data é feriado, favor alterar!");
                    this.txtPrazoResposta.Enabled = true;
                    this.txtHoraLimiteResp.Enabled = true;
                    this.lblPrazoRespostaDia.Visible = false;
                }
                else {
                    this.txtPrazoResposta.Enabled = false;
                    this.txtHoraLimiteResp.Enabled = false;
                    this.txtHoraLimiteResp.textBoxHorario.SetText(pedido.Hora);
                    this.txtPrazoResposta.Date = ConvertToDate(data);
                    this.exibirDiaDaSemana(this.txtPrazoResposta.Date.getDay());
                }
            }
        }
    };
    // este método é para o cenário de ser feriado no prazo de resposta
    // caso a nova data ser feriado também, ele emite novo alerta
    C_PedComSemanal.prototype.retornaDiaDaSemana = function () {
        var param = {
            dia: this.cboGradeSemanalRemessa.GetSelectedIndex() + 1,
            empresa: this.lstEmpresaRemessa.GetAllValues()[0],
            diaEmissao: this.txtPrazoResposta.Date.getDate(),
            mes: this.txtPrazoResposta.Date.getMonth() + 1,
            ano: this.txtPrazoResposta.Date.getFullYear()
        };
        //este método retorna se o dia será feriado ou não.
        var isFeriado = this.ExecutarFuncaoServerSideSynch("ValidaData", param);
        if (isFeriado) {
            MostrarAlerta("Esta data é feriado, favor alterar!");
            this.txtPrazoResposta.Enabled = true;
            this.txtHoraLimiteResp.Enabled = true;
            this.lblPrazoRespostaDia.Visible = false;
            this.txtPrazoResposta.Date = null;
        }
        else {
            if (!this.txtDataEmissao.Date.isAfter(this.txtPrazoResposta.Date, false)) {
                this.exibirDiaDaSemana(this.txtPrazoResposta.Date.getDay());
            }
            else {
                MostrarAlerta("o Prazo de Resposta não pode ser menor que a Data de Emissão, Insira uma nova Data!");
                this.lblPrazoRespostaDia.Visible = false;
                this.txtPrazoResposta.Date = null;
            }
        }
    };
    //seta o dia da semana que será o prazo de resposta 
    C_PedComSemanal.prototype.exibirDiaDaSemana = function (diaSemana) {
        if (diaSemana != null) {
            this.lblPrazoRespostaDia.Visible = true;
            switch (diaSemana) {
                case 0:
                    this.lblPrazoRespostaDia.Text = "Domingo";
                    break;
                case 1:
                    this.lblPrazoRespostaDia.Text = "Segunda-Feira";
                    break;
                case 2:
                    this.lblPrazoRespostaDia.Text = "Terça-Feira";
                    break;
                case 3:
                    this.lblPrazoRespostaDia.Text = "Quarta-Feira";
                    break;
                case 4:
                    this.lblPrazoRespostaDia.Text = "Quinta-Feira";
                    break;
                case 5:
                    this.lblPrazoRespostaDia.Text = "Sexta-Feira";
                    break;
                case 6:
                    this.lblPrazoRespostaDia.Text = "Sábado";
                    break;
                default:
                    break;
            }
        }
    };
    //abre o modal com os produtos do pedido quando clicar no botão + na grade de retorno 
    C_PedComSemanal.prototype.ExibeModalSubExpandir = function (data) {
        this.mdSubExpandir.Show();
        var par = {
            codigo: data.Codigo,
            empresa: data.Empresa
        };
        var produtos = this.ExecutarFuncaoServerSideSynch("produtosGradeSubRetorno", par);
        var listaSub = new Array();
        produtos.forEach(function (produto) {
            var x = {};
            x.Codigo_Produto = produto.Cod_Produto;
            x.Descricao_Produto = produto.Descricao_Produto;
            x.Quantidade = produto.Quantidade;
            x.Custo = produto.Custo;
            x.Valor_Venda = produto.Venda;
            x.PACK = produto.Pack;
            x.Veiculacao = produto.Veiculacao;
            x.Sortimento = produto.Sortimento;
            listaSub.push(x);
        });
        this.SubRetorno = listaSub;
        this.RefreshAngular();
    };
    C_PedComSemanal.prototype.ExibeModalFornecedor = function () {
        this.mdDadosFornecedor.Show();
    };
    C_PedComSemanal.prototype.ExibeModalReprovar = function () {
        this.mdReprovarPedido.Show();
    };
    C_PedComSemanal.prototype.onClickGravarReprova = function () {
        var par = {
            codigo: this.data.Codigo,
            motivo: this.txtAreaReprovacao.GetText(),
            empresa: this.data.Empresa
        };
        this.ExecutarFuncaoServerSideSynch("reprovarPedido", par);
        this.gerarPedidosRetorno();
        this.mdReprovarPedido.Hide();
    };
    C_PedComSemanal.prototype.OnClickEnviarEmail = function () {
        if (this.EnvioEmail) {
            var par = {};
            //fazer o método abaixo.
            var destinatarios = this.ExecutarFuncaoServerSideSynch("destinatariosEmail", par);
            this.EnvioEmail.MostrarClient([], [], "", "");
        }
    };
    //limpar campos da aba remessa
    C_PedComSemanal.prototype.onLimparRemessa = function () {
        var x = {};
        this.txtCodigo.Limpar();
        this.txtDataEmissao.Date = this.DataServidor();
        this.cboGradeSemanalRemessa.SetSelectedIndex(-1);
        this.lstEmpresaRemessa.LimparSelecao();
        this.lstEmpresaRemessa.RemoverTodosItens(true);
        this.txtPrazoResposta.Date = null;
        this.txtHoraLimiteResp.textBoxHorario.SetText("");
        this.txtCompradorRemessa.SetText(ValoresSismoura.UsuarioLogado.toString());
        this.chkFornecedor.LimparSelecao();
        this.gridCurvaABC.PreencherGrid(null);
        this.gridRemessaPedido.Grid.PreencherGrid(null);
        this.btnEmail.SetEnabled(false);
        this.txtUltimoPedido.SetText(this.ExecutarFuncaoServerSideSynch("UltimoPedidoSemanal", x));
    };
    //limpar campos da aba retorno
    C_PedComSemanal.prototype.onLimparRetorno = function () {
        this.txtPeriodo.IniciarDataAtual();
        this.txtDataEmissao.Date = this.DataServidor();
        this.cboGradeSemanalRetorno.SetSelectedIndex(-1);
        this.lstEmpresaRetorno.LimparSelecao();
        this.lstEmpresaRetorno.RemoverTodosItens(true);
        this.gridRetornoPedido.Grid.PreencherGrid(null);
        this.txtPrazoResposta.Date = null;
        this.txtHoraLimiteResp.textBoxHorario.SetText("");
        this.txtCompradorRemessa.SetText(ValoresSismoura.UsuarioLogado.toString());
        this.chkFornecedor.LimparSelecao();
        this.gridCurvaABCRetorno.PreencherGrid(null);
    };
    // quando clicar no botão gravar da aba de remessa
    C_PedComSemanal.prototype.onClickGravar = function () {
        var _this = this;
        if (ValoresSismoura.ConfiguracoesRetaguarda.Usuario_Franqueador) {
            if (this.validaCamposRemessa()) {
                var par = {
                    codigo: this.lstEmpresaRemessa.GetValuesNumber()
                };
                if (this.txtUltimoPedido.GetText() == "Este é o Primeiro Pedido!") {
                    var pedSemanal = {
                        dataEmissao: this.txtDataEmissao.Date,
                        gradeSemanal: this.cboGradeSemanalRemessa.Combo.GetSelectedIndex() + 1,
                        prazoResposta: this.ExecutarFuncaoServerSideSynch("ObterPrazoResposta", par),
                        horaLimite: this.txtHoraLimiteResp.textBoxHorario.GetText(),
                        comprador: CNum(this.txtCompradorRemessa.GetText()),
                        tela: ValoresSismoura.NomeTela,
                        usuario: ValoresSismoura.UsuarioLogado,
                        remessas: this.Remessas,
                        empresas: this.lstEmpresaRemessa.GetValues(),
                        codigo: 1
                    };
                }
                else {
                    var pedSemanal = {
                        dataEmissao: this.txtDataEmissao.Date,
                        gradeSemanal: this.cboGradeSemanalRemessa.Combo.GetSelectedIndex() + 1,
                        prazoResposta: this.ExecutarFuncaoServerSideSynch("ObterPrazoResposta", par),
                        horaLimite: this.txtHoraLimiteResp.textBoxHorario.GetText(),
                        comprador: CNum(this.txtCompradorRemessa.GetText()),
                        tela: ValoresSismoura.NomeTela,
                        usuario: ValoresSismoura.UsuarioLogado,
                        remessas: this.Remessas,
                        empresas: this.lstEmpresaRemessa.GetValues(),
                        codigo: Number(this.txtUltimoPedido.GetText()) + 1
                    };
                }
                this.txtCodigo.SetText(this.ExecutarFuncaoServerSideSynch("GravarPedidoSemanal", pedSemanal));
                this.btnEmail.SetEnabled(true);
                MostrarMensagem("Pedido Gravado com Sucesso!");
                this.onLimparRemessa();
            }
        }
        else {
            var isQuantificados = true;
            this.Remessas.forEach(function (remessa, index) {
                remessa.Quantidade = _this.gridRemessaPedido.Grid.DataSource[index].Quantidade;
                remessa.Situacao_Atual = "Retorno";
                remessa.Valor = _this.gridRemessaPedido.Grid.DataSource[index].Valor;
            });
            this.Remessas.forEach(function (remessa) {
                if (remessa.Quantidade == 0) {
                    isQuantificados = false;
                }
            });
            if (isQuantificados) {
                var pedSemanal = {
                    tela: ValoresSismoura.NomeTela,
                    usuario: ValoresSismoura.UsuarioLogado,
                    remessas: this.Remessas,
                    linhasAlteradas: this.linhasQuantidade
                };
                this.ExecutarFuncaoServerSideSynch("AlterarPedidoSemanal", pedSemanal);
                this.btnEmail.SetEnabled(true);
                MostrarMensagem("Pedido Alterado com Sucesso!");
                this.onLimparRemessa();
            }
            else {
                MostrarAlerta("Por favor, Insira a Quantidade de Cada Produto!");
            }
        }
    };
    //valida campos obrigatórios da aba remesa
    C_PedComSemanal.prototype.validaCamposRemessa = function () {
        var check = true;
        if (this.cboGradeSemanalRemessa.GetSelectedIndex() == -1) {
            MostrarAlerta("Preencha o campo corretamente: Grade Semanal");
            check = false;
        }
        if (this.txtDataEmissao.Date == null) {
            MostrarAlerta("Preencha o campo corretamente: Data Emissão");
            check = false;
        }
        if (this.txtPrazoResposta.Date == null) {
            MostrarAlerta("Preencha o campo corretamente: Prazo Resposta");
            check = false;
        }
        if (this.txtHoraLimiteResp.textBoxHorario.GetText == null) {
            MostrarAlerta("Preencha o campo corretamente: Horário Limite para Resposta");
            check = false;
        }
        if (this.lstEmpresaRemessa.GetValues().length == 0) {
            MostrarAlerta("Preencha o campo corretamente: Empresa");
            check = false;
        }
        if (this.chkFornecedor.GetValues().length == 0) {
            MostrarAlerta("Preencha o campo corretamente: Fornecedor");
            check = false;
        }
        if (this.gridRemessaPedido.Grid.DataSource.length == 0) {
            MostrarAlerta("Preencha o campo corretamente: Grade Remessa");
            check = false;
        }
        return check;
    };
    // valida se o usuário é franqueado, pois se for, terá visão e funcionalidade diferentes relativos a tela de pedido de compra semanal.
    C_PedComSemanal.prototype.isFranqueado = function () {
        var _this = this;
        if (!this.GetScope())
            return;
        var pedido = Number(this.txtUltimoPedido.GetText()) >= 0 ? Number(this.txtUltimoPedido.GetText()) : 0;
        this.tab.AlterarVisibleAba("AbaRetornoPedido", false);
        //faltou criatividade, mas a variavel isUnico se true coloca uma subquery dentro do sql.
        var par = {
            usuario: ValoresSismoura.UsuarioLogado,
            dia: this.cboGradeSemanalRemessa.GetSelectedIndex() + 1,
            pedido: pedido,
            isUnico: false
        };
        var pedidosSemanaisItem = this.ExecutarFuncaoServerSideSynch("ListarPedidosPorFranqueado", par);
        this.cboGradeSemanalRemessa.SetSelectedIndex(pedidosSemanaisItem[pedidosSemanaisItem.length - 1].Grade_Semanal - 1);
        var par = {
            usuario: ValoresSismoura.UsuarioLogado,
            dia: this.cboGradeSemanalRemessa.GetSelectedIndex() + 1,
            pedido: pedido,
            isUnico: true
        };
        var pedidosSemanaisItem = this.ExecutarFuncaoServerSideSynch("ListarPedidosPorFranqueado", par);
        if (pedidosSemanaisItem.length > 0 && pedidosSemanaisItem[0].ListaItens.length > 0) {
            var listaRemessa = new Array();
            var id = 1;
            pedidosSemanaisItem.forEach(function (pedido) {
                pedido.ListaItens.forEach(function (pedidoItem) {
                    if (pedido.Codigo == pedidoItem.Cod_Pedido_Semanal) {
                        pedido.ListaEmpresas.forEach(function (pedidoEmpresa) {
                            if (pedidoEmpresa.Cod_Pedido_Semanal == pedidoItem.Cod_Pedido_Semanal) {
                                var par = {
                                    codigo: pedidoItem.Cod_Produto
                                };
                                var item = {};
                                item.Codigo = pedidoItem.Codigo;
                                item.Pedido = pedido.Codigo;
                                item.Id = id;
                                item.Linha = _this.ExecutarFuncaoServerSideSynch("NomeLinha", par);
                                item.Codigo_Linha = pedidoItem.Linha;
                                item.Empresa = pedidoEmpresa.Empresa;
                                item.Deposito = pedidoItem.Deposito;
                                item.Local_Deposito = pedidoItem.Local_Deposito;
                                item.Fornecedor = pedidoItem.Fornecedor;
                                item.Venda = pedidoItem.Venda;
                                //item.Colecao = this.selecionadas[i].Colecao;
                                item.Codigo_Produto = pedidoItem.Cod_Produto;
                                item.Codigo_Fabrica = pedidoItem.Cod_Produto_Fabrica;
                                item.Descricao_Produto = pedidoItem.Descricao_Produto;
                                item.Custo = pedidoItem.Custo;
                                item.Situacao_Atual = pedidoItem.Situacao_Atual;
                                item.Veiculacao = pedidoItem.Veiculacao;
                                item.PACK = pedidoItem.Pack;
                                item.Sortimento = pedidoItem.Sortimento;
                                item.Quantidade = pedidoItem.Quantidade;
                                item.Valor = pedidoItem.Valor;
                                listaRemessa.push(item);
                                id++;
                            }
                        });
                    }
                });
                cont = 0;
            });
            // SETAR DADOS NA GRADE REMESSA
            this.Remessas = listaRemessa;
            this.gridRemessaPedido.Grid.ColunaVisible("Pedido", true);
            this.gridRemessaPedido.Grid.GroupBy("Fornecedor");
            this.gridRemessaPedido.Grid.GroupBy("Empresa");
            this.gridRemessaPedido.Grid.GroupBy("Linha");
            this.gridRemessaPedido.Grid.GroupBy("Deposito");
            this.gridRemessaPedido.Grid.GroupBy("Pedido");
            this.gridRemessaPedido.Grid.OrderBy("Fornecedor", "asc");
            this.RefreshAngular();
            // LISTAR E SELECIONAR FORNECEDORES 
            var fornecedoresCheck = new Array();
            var cont = 0;
            pedidosSemanaisItem.forEach(function (pedido) {
                pedido.ListaItens.forEach(function (pedidoItem) {
                    if (cont == 0) {
                        _this.chkFornecedor.GetValuesRelacao().forEach(function (campo) {
                            if (pedido.ListaItens.FindAll("Fornecedor", campo).length > 0) {
                                fornecedoresCheck.push(campo);
                            }
                        });
                        cont++;
                    }
                });
                cont = 0;
            });
            var emp = pedidosSemanaisItem[0].ListaEmpresas[0].Empresa;
            this.txtCompradorRemessa.SetText(pedidosSemanaisItem[pedidosSemanaisItem.length - 1].Comprador.toString());
            this.txtDataEmissao.Date = pedidosSemanaisItem[pedidosSemanaisItem.length - 1].Data_Emissao.ToDate();
            this.txtCodigo.SetText(pedidosSemanaisItem[pedidosSemanaisItem.length - 1].Codigo.toString());
            // LISTAR EMPRESAS E SELECIONAR AS QUE ESTÃO CADASTRADAS NO PEDIDO SEMANAL
            var gradeSemanalRemessa = this.cboGradeSemanalRemessa.GetSelectedIndex() + 1;
            var parametros = {
                dia: gradeSemanalRemessa,
                usuario: ValoresSismoura.UsuarioLogado
            };
            // recupera as listas de empresas da grade semanal que pertecem ao usuario logado
            var empresas = this.ExecutarFuncaoServerSideSynch("ListaEmpresasRelacionadasAoDia", parametros);
            for (var _i = 0, empresas_3 = empresas; _i < empresas_3.length; _i++) {
                var empresa = empresas_3[_i];
                parametros = {
                    codigo: empresa
                };
                this.lstEmpresaRemessa.AdicionarItem(this.ExecutarFuncaoServerSideSynch("NomeEmpresa", parametros), empresa);
            }
            var empp = new Array();
            // recupera empresas que já foram salvas no banco para serem ticadas no checkbox list
            this.lstEmpresaRemessa.GetAllValues().forEach(function (values, index) {
                if (listaRemessa.FindAll("Empresa", values).length > 0) {
                    empp.push(values.toString());
                }
            });
            this.lstEmpresaRemessa.SetValues(empp);
            var param = {
                dia: this.cboGradeSemanalRemessa.GetSelectedIndex(),
                empresa: pedidosSemanaisItem[0].ListaEmpresas[0].Empresa,
                diaEmissao: this.txtDataEmissao.Date.getDate(),
                mes: this.txtDataEmissao.Date.getMonth() + 1,
                ano: this.txtDataEmissao.Date.getFullYear()
            };
            var data = this.ExecutarFuncaoServerSideSynch("InformaData", param);
            var hora;
            if (pedidosSemanaisItem[0].Hora_Limite_Resposta.Minutes < 10) {
                hora = pedidosSemanaisItem[0].Hora_Limite_Resposta.Hours + ":0" + pedidosSemanaisItem[0].Hora_Limite_Resposta.Minutes;
            }
            else {
                hora = pedidosSemanaisItem[0].Hora_Limite_Resposta.Hours + ":" + pedidosSemanaisItem[0].Hora_Limite_Resposta.Minutes;
            }
            this.txtPrazoResposta.Enabled = false;
            this.txtHoraLimiteResp.Enabled = false;
            this.txtDataEmissao.Enabled = false;
            this.cboGradeSemanalRemessa.Enabled = false;
            this.txtCompradorRemessa.Enabled = false;
            this.chkFornecedor.SetValues(fornecedoresCheck);
            this.chkFornecedor.Enabled = false;
            this.lstEmpresaRemessa.Enabled = false;
            this.txtHoraLimiteResp.textBoxHorario.SetText(hora);
            this.txtPrazoResposta.Date = ConvertToDate(data);
            this.exibirDiaDaSemana(this.txtPrazoResposta.Date.getDay());
        }
        else {
            MostrarAlerta("Não existem Pedidos relacionado as Empresas deste Usuário!");
        }
    };
    C_PedComSemanal.prototype.gerarPedidosRetorno = function () {
        var _this = this;
        var par = {
            usuario: ValoresSismoura.UsuarioLogado,
            dia: this.cboGradeSemanalRetorno.GetSelectedIndex() + 1,
            inicio: this.txtPeriodo.textBoxCalendarioInicio.GetDate(),
            fim: this.txtPeriodo.textBoxCalendarioFim.GetDate(),
            empresas: this.lstEmpresaRetorno.GetValuesNumber()
        };
        var pedidosSemanais = this.ExecutarFuncaoServerSideSynch("PedidosSemanaisStatusRetorno", par);
        var listaRetorno = new Array();
        pedidosSemanais.forEach(function (pedido, index) {
            pedido.ListaEmpresas.forEach(function (pedidoEmpresa, indice) {
                var item = {};
                var jsonFornecedor = {
                    codigo: pedido.ListaItens[0].Fornecedor
                };
                var jsonComprador = {
                    codigo: pedido.Comprador
                };
                item.Empresa = pedidoEmpresa.Empresa;
                item.Codigo = pedidoEmpresa.Cod_Pedido_Semanal;
                item.Data_Emissao = pedido.Data_Emissao;
                _this.cboGradeSemanalRemessa.SetSelectedIndex(pedido.Grade_Semanal - 1);
                item.Grade_Semanal = _this.cboGradeSemanalRemessa.GetText();
                item.Comprador = _this.ExecutarFuncaoServerSideSynch("obterComprador", jsonComprador);
                item.Fornecedor_Nome = _this.ExecutarFuncaoServerSideSynch("obterFornecedor", jsonFornecedor);
                item.Fornecedor = pedido.ListaItens[indice].Fornecedor;
                item.Forma_Pagamento = pedidoEmpresa.Forma_Pagamento.toString();
                item.Situacao_Atual = pedido.ListaItens[indice].Situacao_Atual;
                listaRetorno.push(item);
            });
        });
        this.Retorno = listaRetorno;
        this.gridRetornoPedido.Grid.GroupBy("Fornecedor");
        this.gridRetornoPedido.Grid.GroupBy("Empresa");
        this.gridRetornoPedido.Grid.OrderBy("Codigo", "asc");
        this.RefreshAngular();
    };
    return C_PedComSemanal;
}(MouraPageAngular));
var c_PedComSemanal = new C_PedComSemanal();
//# sourceMappingURL=C_PedComSemanal.js.map