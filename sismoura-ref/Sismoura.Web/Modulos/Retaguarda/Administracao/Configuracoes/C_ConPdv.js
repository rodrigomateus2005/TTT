var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var C_ConPdv = /** @class */ (function (_super) {
    __extends(C_ConPdv, _super);
    function C_ConPdv() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(C_ConPdv.prototype, "grd", {
        get: function () {
            return window['grd_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnSalvar", {
        get: function () {
            return window['btnSalvar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnCopiarConfig", {
        get: function () {
            return window['btnCopiarConfig_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "mdPdvs", {
        get: function () {
            return window['mdPdvs_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "grdPdvs", {
        get: function () {
            return window['grdPdvs_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnOKPdvs", {
        get: function () {
            return window['btnOKPdvs_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnCancelarPdvs", {
        get: function () {
            return window['btnCancelarPdvs_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "mdCopiarConfiguracoes", {
        get: function () {
            return window['mdCopiarConfiguracoes_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtEmpresaOrigem", {
        get: function () {
            return window['txtEmpresaOrigem_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "cboPdvOrigem", {
        get: function () {
            return window['cboPdvOrigem_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "grdPdvsDestino", {
        get: function () {
            return window['grdPdvsDestino_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnOKCopiar", {
        get: function () {
            return window['btnOKCopiar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnCancelarCopiar", {
        get: function () {
            return window['btnCancelarCopiar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "mdConfig", {
        get: function () {
            return window['mdConfig_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "hdnConfiguracao", {
        get: function () {
            return $('#hdnConfiguracao')[0];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "hdnIdComponente", {
        get: function () {
            return $('#hdnIdComponente')[0];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "lblConfiguracao", {
        get: function () {
            return window['lblConfiguracao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtValorAtual", {
        get: function () {
            return window['txtValorAtual_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtDica", {
        get: function () {
            return window['txtDica_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnOK", {
        get: function () {
            return window['btnOK_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "btnCancelar", {
        get: function () {
            return window['btnCancelar_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "cboComboItemData", {
        get: function () {
            return window['cboComboItemData_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "cboComboListIndex", {
        get: function () {
            return window['cboComboListIndex_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "cboComboText", {
        get: function () {
            return window['cboComboText_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtData", {
        get: function () {
            return window['txtData_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtTexto", {
        get: function () {
            return window['txtTexto_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtDecimal", {
        get: function () {
            return window['txtDecimal_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtNumero", {
        get: function () {
            return window['txtNumero_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "cboSimNao", {
        get: function () {
            return window['cboSimNao_Object'];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(C_ConPdv.prototype, "txtMemo", {
        get: function () {
            return window['txtMemo_Object'];
        },
        enumerable: true,
        configurable: true
    });
    C_ConPdv.prototype.Init = function () {
        _super.prototype.Init.call(this);
        if (this.grd) {
            adicionarEventoMoura(this.grd.SelecionouLinha, this.OnGridSelecionouItem, this);
            adicionarEventoMoura(this.grd.CellPrepared, this.OnGridCellPrepared, this);
        }
        if (this.btnSalvar) {
            adicionarEventoMoura(this.btnSalvar.Click, this.OnClickSalvar, this);
        }
        if (this.btnCopiarConfig) {
            adicionarEventoMoura(this.btnCopiarConfig.Click, this.OnClickCopiarConfig, this);
        }
        if (this.btnOK) {
            adicionarEventoMoura(this.btnOK.Click, this.OnClickOKModal, this);
        }
        if (this.btnCancelar) {
            adicionarEventoMoura(this.btnCancelar.Click, this.OnClickCancelarModal, this);
        }
        if (this.btnOKCopiar) {
            adicionarEventoMoura(this.btnOKCopiar.Click, this.OnClickOKCopiarModal, this);
        }
        if (this.btnCancelarCopiar) {
            adicionarEventoMoura(this.btnCancelarCopiar.Click, this.OnClickCancelarCopiarModal, this);
        }
        if (this.btnOKPdvs) {
            adicionarEventoMoura(this.btnOKPdvs.Click, this.OnClickOKPdvsModal, this);
        }
        if (this.btnCancelarPdvs) {
            adicionarEventoMoura(this.btnCancelarPdvs.Click, this.OnClickCancelarPdvsModal, this);
        }
        if (this.txtEmpresaOrigem) {
            adicionarEventoMoura(this.txtEmpresaOrigem.Procurou, this.OnProcurouEmpresa, this);
        }
    };
    C_ConPdv.prototype.OnPageLoad = function () {
        _super.prototype.OnPageLoad.call(this);
        this.LimparCampos();
        this.PreencherGrade();
        this.IniciarCamposValores();
        this.CarregarPDVS();
    };
    C_ConPdv.prototype.OnProcurouEmpresa = function (s, e) {
        this.CarregarPDVS();
    };
    C_ConPdv.prototype.CarregarPDVS = function () {
        var parametros;
        parametros = {
            codEmpresa: this.txtEmpresaOrigem.GetText().CNum()
        };
        var pdvs = this.ExecutarFuncaoServerSideSynch("GetPdvsByEmpresa", parametros);
        this.cboPdvOrigem.ClearItems();
        if (pdvs) {
            for (var y = 0; y < pdvs.length; y++) {
                this.cboPdvOrigem.AddItem(pdvs[y].Descricao, pdvs[y].Codigo, "");
            }
        }
    };
    C_ConPdv.prototype.OnGridSelecionouItem = function (s, e) {
        this.CarregarConfiguracao(e.rowKey);
        this.mdConfig.Show();
    };
    C_ConPdv.prototype.OnClickSalvar = function (s, e) {
        e.processOnServer = false;
        var configs = [];
        for (var x = 0; x < this.grd.DataSource.length; x++) {
            if (this.grd.DataSource[x].Alterada) {
                configs.push(this.grd.DataSource[x]);
            }
        }
        if (configs.length <= 0) {
            MostrarAlerta("Nenhuma configuração foi alterada!!");
            return;
        }
        this.LimparCamposPdvs();
        this.mdPdvs.Show();
    };
    C_ConPdv.prototype.OnClickCopiarConfig = function (s, e) {
        e.processOnServer = false;
        this.LimparCamposCopiar();
        this.mdCopiarConfiguracoes.Show();
    };
    C_ConPdv.prototype.OnClickOKCopiarModal = function (s, e) {
        e.processOnServer = false;
        var parametros;
        var pdvs = [];
        if (this.cboPdvOrigem.GetValue() == null || this.cboPdvOrigem.GetValue() == undefined) {
            MostrarAlerta("Selecione um Pdv de Origem!!");
            this.cboPdvOrigem.Focus();
            return;
        }
        for (var x = 0; x < this.grdPdvsDestino.GetSelectedRowsData.length; x++) {
            pdvs.push(this.grdPdvsDestino.GetSelectedRowsData[x].Codigo);
        }
        parametros = {
            pdvOrigem: this.cboPdvOrigem.GetValue(),
            pdvDestino: pdvs,
            nomeTela: ValoresSismoura.NomeTela,
            codUsuario: ValoresSismoura.UsuarioLogado
        };
        this.ExecutarFuncaoServerSideSynch("CopiarConfiguracoes", parametros);
        this.grdPdvsDestino.Refresh();
        MostrarMensagem("Configurações copiadas com sucesso!!");
        this.mdCopiarConfiguracoes.Hide();
    };
    C_ConPdv.prototype.OnClickCancelarCopiarModal = function (s, e) {
        e.processOnServer = false;
        this.mdCopiarConfiguracoes.Hide();
    };
    C_ConPdv.prototype.OnClickOKPdvsModal = function (s, e) {
        e.processOnServer = false;
        var configsGrade = this.grd.DataSource;
        var configs = [];
        var pdvs = [];
        var parametros;
        for (var x = 0; x < configsGrade.length; x++) {
            if (configsGrade[x].Alterada) {
                configs.push(configsGrade[x]);
            }
        }
        if (configs.length <= 0) {
            MostrarAlerta("Nenhuma configuração foi alterada!!");
            return;
        }
        if (this.grdPdvs.GetSelectedRowsData.length <= 0) {
            MostrarAlerta("Selecione ao menos um Pdv!!");
            return;
        }
        for (var x = 0; x < this.grdPdvs.GetSelectedRowsData.length; x++) {
            pdvs.push(this.grdPdvs.GetSelectedRowsData[x].Codigo);
        }
        parametros = {
            configs: configs,
            pdvs: pdvs,
            nomeTela: ValoresSismoura.NomeTela,
            codUsuario: ValoresSismoura.UsuarioLogado
        };
        this.ExecutarFuncaoServerSideSynch("SalvarConfigsAlteradasPdvs", parametros);
        for (var x = 0; x < this.grd.DataSource.length; x++) {
            this.grd.DataSource[x].Alterada = false;
        }
        this.grd.Refresh();
        MostrarMensagem("Configurações alteradas com sucesso!!");
        this.mdPdvs.Hide();
    };
    C_ConPdv.prototype.OnClickCancelarPdvsModal = function (s, e) {
        e.processOnServer = false;
        this.mdPdvs.Hide();
    };
    C_ConPdv.prototype.OnClickOKModal = function (s, e) {
        e.processOnServer = false;
        var codConfiguracao;
        var idComponente;
        var valorCampo;
        codConfiguracao = this.hdnConfiguracao.value.CNum();
        idComponente = this.hdnIdComponente.value;
        switch (idComponente) {
            case this.cboSimNao.ID: {
                if (String.IsNullOrWhiteSpace(this.cboSimNao.GetValue())) {
                    MostrarAlerta("Selecione um valor para a configuração");
                    this.cboSimNao.Focus();
                    return;
                }
                valorCampo = this.cboSimNao.GetValue();
                valorCampo = valorCampo.toUpperCase();
                break;
            }
            case this.cboComboItemData.ID: {
                valorCampo = this.cboComboItemData.GetValue();
                break;
            }
            case this.cboComboListIndex.ID: {
                if (this.cboComboListIndex.GetSelectedIndex() == -1) {
                    MostrarAlerta("Selecione uma opção para gravar a configuração");
                    this.cboComboListIndex.Focus();
                    return;
                }
                valorCampo = this.cboComboListIndex.GetSelectedIndex().toString();
                break;
            }
            case this.cboComboText.ID: {
                valorCampo = this.cboComboText.GetText();
                break;
            }
            case this.txtTexto.ID: {
                valorCampo = this.txtTexto.GetText();
                break;
            }
            case this.txtMemo.ID: {
                valorCampo = this.txtMemo.GetText();
                break;
            }
            case this.txtData.ID: {
                valorCampo = this.txtData.Date.FormataData();
                break;
            }
            case this.txtDecimal.ID: {
                valorCampo = this.txtDecimal.GetText().FormatNumber(ValoresSismoura.CasasDecimaisValor);
                break;
            }
            case this.txtNumero.ID: {
                if (this.txtNumero.GetText().CNum() == 0) {
                    MostrarAlerta("Esta configuração permite apenas caracteres numéricos");
                    this.txtNumero.Focus();
                    return;
                }
                valorCampo = this.txtNumero.GetText();
                break;
            }
            default: {
                MostrarAlerta("Configuração não encontrada");
                break;
            }
        }
        var configsGrade = this.grd.DataSource;
        for (var x = 0; x < configsGrade.length; x++) {
            if (configsGrade[x].Codigo == codConfiguracao) {
                configsGrade[x].Valor = valorCampo;
                configsGrade[x].Alterada = true;
            }
        }
        this.grd.Refresh();
        this.mdConfig.Hide();
    };
    C_ConPdv.prototype.OnClickCancelarModal = function (s, e) {
        e.processOnServer = false;
        this.mdConfig.Hide();
    };
    C_ConPdv.prototype.CarregarConfiguracao = function (codConfiguracao) {
        this.IniciarCamposValores();
        this.hdnConfiguracao.value = codConfiguracao.toString();
        var parametros;
        var lista;
        var funcao;
        var idComponente;
        parametros = {
            codConfiguracao: codConfiguracao
        };
        var config = this.ExecutarFuncaoServerSideSynch("CarregarConfiguracao", parametros);
        var configsGrade = this.grd.DataSource;
        if (config) {
            this.lblConfiguracao.Text = config.Descricao;
            //this.txtValorAtual.SetText(config.Valor);
            this.txtDica.SetText(config.Dicas);
            //Verificar se a config já foi alterada na grade
            for (var x = 0; x < configsGrade.length; x++) {
                if (configsGrade[x].Codigo == config.Codigo && configsGrade[x].Alterada) {
                    config.Valor = configsGrade[x].Valor;
                }
            }
            lista = config.Complemento.split(";");
            funcao = config.Funcao.toLowerCase();
            switch (config.Tipo_Dados.toLowerCase()) {
                case "combo_itemdata": {
                    if (String.IsNullOrWhiteSpace(funcao)) {
                        this.cboComboItemData.ClearItems();
                        for (var x = 0; x < lista.length; x++) {
                            this.cboComboItemData.AddItem(lista[x], lista[x], "");
                        }
                    }
                    else {
                        this.PreencherComboConfiguracao(lista, this.cboComboItemData);
                    }
                    this.cboComboItemData.Visible = true;
                    //this.cboComboItemData.SetValue(config.Valor);
                    idComponente = this.cboComboItemData.ID;
                    break;
                }
                case "combo_listindex": {
                    if (String.IsNullOrWhiteSpace(funcao)) {
                        this.cboComboListIndex.ClearItems();
                        for (var x = 0; x < lista.length; x++) {
                            this.cboComboListIndex.AddItem(lista[x], lista[x], "");
                        }
                    }
                    else {
                        //Todo
                    }
                    this.cboComboListIndex.Visible = true;
                    //this.cboComboListIndex.SetSelectedIndex(config.Valor);
                    idComponente = this.cboComboListIndex.ID;
                    break;
                }
                case "combo_text": {
                    this.cboComboText.ClearItems();
                    if (String.IsNullOrWhiteSpace(funcao) || funcao.length < 4) {
                        for (var x = 0; x < lista.length; x++) {
                            this.cboComboText.AddItem(lista[x], lista[x], "");
                        }
                    }
                    else if (funcao == "preencher_descricao") {
                        if (lista.length > 0) {
                            var parametros;
                            parametros = {
                                codTabela: lista[0]
                            };
                            var itens = this.ExecutarFuncaoServerSideSynch("GetItensByTabela", parametros);
                            for (var y = 0; y < itens.length; y++) {
                                this.cboComboText.AddItem(lista[y], lista[y], "");
                            }
                        }
                    }
                    else {
                        //Todo
                    }
                    this.cboComboText.Visible = true;
                    //this.cboComboText.SetValue(config.Valor);
                    idComponente = this.cboComboText.ID;
                    break;
                }
                case "data": {
                    var valor;
                    valor = config.Valor;
                    if (valor instanceof Date) {
                        this.txtData.Date = config.Valor.ToDate();
                    }
                    else {
                        this.txtData.Date = null;
                    }
                    this.txtData.Visible = true;
                    idComponente = this.txtData.ID;
                    break;
                }
                case "texto": {
                    //this.txtTexto.SetText(config.Valor);
                    this.txtTexto.Visible = true;
                    idComponente = this.txtTexto.ID;
                    break;
                }
                case "decimal": {
                    //this.txtDecimal.SetText(config.Valor);
                    this.txtDecimal.Visible = true;
                    idComponente = this.txtDecimal.ID;
                    break;
                }
                case "número": {
                    //this.txtNumero.SetText(config.Valor);
                    this.txtNumero.Visible = true;
                    idComponente = this.txtNumero.ID;
                    break;
                }
                case "sim/não": {
                    if (String.IsNullOrWhiteSpace(config.Valor)) {
                        this.cboSimNao.LimparSelecao();
                    }
                    else {
                        //this.cboSimNao.SetValue(config.Valor);
                    }
                    this.cboSimNao.Visible = true;
                    idComponente = this.cboSimNao.ID;
                    break;
                }
                case "memo": {
                    //this.txtMemo.SetText(config.Valor);
                    this.txtMemo.Visible = true;
                    idComponente = this.txtMemo.ID;
                    break;
                }
                default: {
                    //this.txtTexto.SetText(config.Valor);
                    this.txtTexto.Visible = true;
                    idComponente = this.txtTexto.ID;
                    break;
                }
            }
            this.hdnIdComponente.value = idComponente;
        }
    };
    C_ConPdv.prototype.PreencherGrade = function () {
        try {
            var parametros = {};
            var cad = this.ExecutarFuncaoServerSideSynch("CarregarConfiguracoesGrade", parametros);
            this.grd.PreencherGrid(cad);
            this.grd.GroupBy("Grupo");
            this.grd.CollapseAll();
            var pdvs = this.ExecutarFuncaoServerSideSynch("GetPdvs", parametros);
            this.grdPdvsDestino.PreencherGrid(pdvs);
            this.grdPdvs.PreencherGrid(pdvs);
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_ConPdv.prototype.OnGridCellPrepared = function (s, e) {
        try {
            if (e.rowType == "data" && e.data != null) {
                if (e.data.Alterada) {
                    e.cellElement.css("color", "#FF0000");
                }
            }
        }
        catch (ex) {
            LogarException(ex);
        }
    };
    C_ConPdv.prototype.IniciarCamposValores = function () {
        this.hdnConfiguracao.value = "";
        this.hdnIdComponente.value = "";
        this.lblConfiguracao.Text = "";
        this.txtValorAtual.SetText("");
        this.txtDica.SetText("");
        this.txtValorAtual.Visible = false;
        this.txtTexto.Visible = false;
        this.txtDecimal.Visible = false;
        this.txtNumero.Visible = false;
        this.txtMemo.Visible = false;
        this.cboSimNao.Visible = false;
        this.txtData.Visible = false;
        this.cboComboItemData.Visible = false;
        this.cboComboListIndex.Visible = false;
        this.cboComboText.Visible = false;
        this.txtTexto.SetText("");
        this.txtDecimal.SetText("");
        this.txtNumero.SetText("");
        this.txtMemo.SetText("");
        this.cboSimNao.LimparSelecao();
        this.txtData.Date = null;
        this.cboComboItemData.LimparSelecao();
        this.cboComboListIndex.LimparSelecao();
        this.cboComboText.LimparSelecao();
    };
    C_ConPdv.prototype.LimparCamposCopiar = function () {
        this.txtEmpresaOrigem.Limpar();
        this.cboPdvOrigem.LimparSelecao();
        //this.grdPdvsDestino.PreencherGrid([]);
        this.grdPdvsDestino.LimparFiltros();
        this.grdPdvsDestino.LimparSelecao();
        this.grdPdvsDestino.Refresh();
    };
    C_ConPdv.prototype.LimparCamposPdvs = function () {
        //this.grdPdvs.PreencherGrid([]);
        this.grdPdvs.LimparFiltros();
        this.grdPdvs.LimparSelecao();
        this.grdPdvs.Refresh();
    };
    C_ConPdv.prototype.LimparCampos = function () {
        this.grd.LimparFiltros();
        this.grd.LimparSelecao();
        this.grd.Refresh();
        this.LimparCamposCopiar();
        this.LimparCamposPdvs();
    };
    C_ConPdv.prototype.PreencherComboConfiguracao = function (lista, cbo) {
        var inic = 0;
        var itemAdicionar;
        var nItemData;
        this.cboComboItemData.ClearItems();
        if (lista) {
            // Os itens com # devem ser adicionados primeiro
            lista.filter(function (e) { return e.startsWith('#'); }).forEach(function (e) {
                var item = e.split('|');
                cbo.AddItem(item[0], item[1], '');
            });
            // Pego a POSIÇÃO do primeiro elemento após os dados com #
            inic = lista.indexOf(lista.filter(function (e) { return !e.startsWith('#'); })[0]);
            // Ao sair do loop, sobram 3 campos:
            // (0) tabela, (1) código e (2) descrição, respectivamente
            var parametros = {
                tabela: lista[inic],
                codigo: lista[inic + 1],
                descricao: lista[inic + 2],
            };
            var retorno = this.ExecutarFuncaoServerSideSynch('RetornaDadosCombo', parametros);
            if (retorno) {
                for (var _i = 0, retorno_1 = retorno; _i < retorno_1.length; _i++) {
                    var linha = retorno_1[_i];
                    cbo.AddItem(linha.Descricao, linha.Codigo, '');
                }
            }
            this.RefreshAngular();
        }
    };
    return C_ConPdv;
}(MouraPageAngular));
var c_ConPdv = new C_ConPdv();
//# sourceMappingURL=C_ConPdv.js.map